<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Obrigações Diárias</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
:root {
    --primary: #4361ee;
    --secondary: #3f37c9;
    --success: #4cc9f0;
    --warning: #f72585;
    --danger: #e63946;
    --dark: #212529;
    --light: #f8f9fa;
    --gray: #6c757d;
    --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    --transition: all 0.3s ease;
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
    background-color: #f0f2f5;
    color: #333;
    line-height: 1.6;
    padding: 0;
    margin: 0;
}

.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
    display: grid;
    grid-template-columns: 320px 1fr;
    gap: 20px;
}

header {
    background: linear-gradient(120deg, var(--primary), var(--secondary));
    color: white;
    padding: 20px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    margin-bottom: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.logo {
    display: flex;
    align-items: center;
    gap: 10px;
}

.logo i {
    font-size: 28px;
}

.logo h1 {
    font-size: 24px;
    font-weight: 700;
}

.header-actions {
    display: flex;
    gap: 15px;
}

.btn {
    background-color: var(--primary);
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 5px;
    transition: var(--transition);
}

.btn:hover {
    background-color: var(--secondary);
    transform: translateY(-2px);
}

.btn-outline-A {
    background-color: transparent;
    border: 1px solid white;
}

.btn-outline:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

.sidebar {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: var(--card-shadow);
    height: fit-content;
}

.sidebar-section {
    margin-bottom: 25px;
    background: #0068cf00;
}


.sidebar-section h3 {
    font-size: 16px;
    margin-bottom: 15px;
    color: #3d3d3d;
    display: flex;
    align-items: center;
    gap: 8px;
}

.sidebar-section h3 i {
    color: var(--primary);
}

.form-group-atalhos {
    background-color: #f8f9fa;
    border-radius: 12px;
    border: 1px solid #ddd;
    padding: 20px;
}

.form-group-atalhos {
    color: #2c3e50;
}

.btn-outline-b {
    background-color: transparent;
    border: 1px solid #4361ee;
    color: #2c3e50;
}


.form-group {
    margin-bottom: 15px;
    color: #2c3e50; 
}

label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    font-size: 14px;
    color: #2c3e50;
}

input, textarea, select {
    width: 100%;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 14px;
    transition: var(--transition);
    background-color: #f8f9fa;
    color: #2c3e50;
}

input:focus, textarea:focus, select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
    background-color: white;
}

textarea {
    min-height: 120px;
    resize: vertical;
}

.checkbox-group {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 10px;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 5px;
    font-weight: normal;
    cursor: pointer;
    background: #f5f7fa;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 13px;
    transition: var(--transition);
    color: #2c3e50;
}

.checkbox-label:hover {
    background: #e9ecef;
}

.checkbox-label input {
    width: auto;
}

.tag-input {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
}

.tag-input input {
    flex: 1;
}

.tag-list {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 10px;
}

.tag {
    background: var(--primary);
    color: white;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 5px;
}

.tag i {
    cursor: pointer;
    font-size: 10px;
}

.image-preview {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 10px;
}

.image-preview img {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 8px;
    border: 1px solid #ddd;
    cursor: pointer;
    transition: var(--transition);
}

.image-preview img:hover {
    transform: scale(1.05);
}

.main-content {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.dashboard {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: var(--card-shadow);
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

.dashboard-card {
    background: #2c51f7;
    border-radius: 8px;
    padding: 15px;
    text-align: center;
}

.dashboard-number {
    font-size: 24px;
    font-weight: bold;
    color: rgb(255, 255, 255);
    margin-bottom: 5px;
}

.dashboard-label {
    font-size: 14px;
    color: white;
}

.filters {
    width: 100%;
    max-width: 1100px;
    margin: 0 auto;
    padding: 32px 32px;
    box-sizing: border-box;
    display: flex;
    flex-wrap: wrap;
    gap: 24px;
    align-items: center;
    background: white;
    border-radius: 16px;
}   

.search-box {
    flex: 2;
    position: relative; 
    min-width: 320px;
} 

.search-box i {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray);
}

.search-box input {
    padding-left: 35px;
}

.filter-select {
    min-width: 260px;
    flex: 1;
}

.view-options {
    display: flex;
    gap: 10px;
}

.view-btn {
    background: #f5f7fa;
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: var(--transition);
}


.obrigacoes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
}

.obrigacao-card {
    border-radius: 12px;
    overflow: hidden;
    box-shadow: var(--card-shadow);
    transition: var(--transition);
    cursor: pointer;
    position: relative;
    background: #e3f2fd;
    color: #2c3e50;
}
         
.obrigacao-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
}

.card-header {
    padding: 15px;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
}

.card-title {
    font-size: 16px;
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 5px;
}

.card-subtitle {
    font-size: 13px;
    color: #546e7a;
}

.card-badge {
    background: var(--primary);
    color: white;
    padding: 4px 8px;
    border-radius: 20px;
    font-size: 12px;
}

.card-content {
    padding: 15px;
}

.card-preview {
    font-size: 14px;
    color: #546e7a;
    margin-bottom: 15px;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.card-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    margin-bottom: 15px;
}

.card-tag {
    background: rgba(255, 255, 255, 0.7);
    color: #2c3e50;
    padding: 3px 8px;
    border-radius: 20px;
    font-size: 11px;
    border: 1px solid rgba(0, 0, 0, 0.1);
}

.card-footer {
    padding: 15px;
    border-top: 1px solid rgba(0, 0, 0, 0.05);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.card-actions {
    display: flex;
    gap: 10px;
}

.card-btn {
    background: rgba(180, 11, 11, 0);
    border: none;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: var(--transition);
    color: #4361ee;
    border: 1px solid rgb(4, 0, 255);
}

.card-btn:hover {
    background: white;
    color: var(--primary);
    transform: scale(1.1);
}

.prioridade-urgente {
    border-left: 4px solid #e74c3c;
    background: linear-gradient(90deg, #ffeaea, #e3f2fd);
}

.prioridade-alta {
    border-left: 4px solid #e67e22;
    background: linear-gradient(90deg, #fff4e6, #e3f2fd);
}

.prioridade-media {
    border-left: 4px solid #f1c40f;
    background: linear-gradient(90deg, #fffde6, #e3f2fd);
}

.prioridade-baixa {
    border-left: 4px solid #2ecc71;
    background: linear-gradient(90deg, #f0fff4, #e3f2fd);
}

.badge-prioridade {
    padding: 3px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: bold;
    margin-left: 8px;
}

.badge-urgente { background: #e74c3c; color: white; }
.badge-alta { background: #e67e22; color: white; }
.badge-media { background: #f1c40f; color: #333; }
.badge-baixa { background: #2ecc71; color: white; }

.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.modal-content {
    background: white;
    border-radius: 12px;
    width: 100%;
    max-width: 800px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
}

.modal-header {
    padding: 20px;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-title {
    font-size: 20px;
    font-weight: 600;
    color: var(--dark);
}

.modal-close {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: var(--gray);
}

.modal-body {
    padding: 20px;
}

.modal-section {
    margin-bottom: 20px;
}

.modal-section h3 {
    font-size: 16px;
    margin-bottom: 10px;
    color: var(--dark);
    display: flex;
    align-items: center;
    gap: 8px;
}

.modal-section h3 i {
    color: var(--primary);
}

.step-list {
    list-style-type: none;
}

.step-item {
    padding: 10px 0;
    border-bottom: 1px solid #f0f0f0;
    display: flex;
    align-items: flex-start;
    gap: 10px;
}

.step-number {
    background: var(--primary);
    color: white;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    flex-shrink: 0;
}

.link-list {
    list-style-type: none;
}

.link-item {
    padding: 10px 0;
    border-bottom: 1px solid #f0f0f0;
    display: flex;
    align-items: center;
    gap: 10px;
}

.link-item a {
    color: var(--primary);
    text-decoration: none;
    transition: var(--transition);
}

.link-item a:hover {
    text-decoration: underline;
}

.image-gallery {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 10px;
}

.gallery-image {
    width: 120px;
    height: 120px;
    object-fit: cover;
    border-radius: 8px;
    cursor: pointer;
    transition: var(--transition);
}

.gallery-image:hover {
    transform: scale(1.05);
}

.modal-footer {
    padding: 20px;
    border-top: 1px solid #eee;
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

.card-edit-mode {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: white;
    border-radius: 12px;
    padding: 15px;
    z-index: 10;
    overflow-y: auto;
}

.card-edit-form {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.card-edit-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 10px;
}

.substeps {
    margin-left: 20px;
    border-left: 2px solid #eee;
    padding-left: 15px;
    margin-top: 5px;
}

.substep {
    position: relative;
    padding: 5px 0;
}

.substep:before {
    content: "↳ ";
    position: absolute;
    left: -15px;
    color: var(--primary);
}

.notification-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.notification {
    background: white;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    display: flex;
    align-items: center;
    gap: 10px;
    animation: slideIn 0.3s ease;
}

.notification.success {
    border-left: 4px solid var(--success);
}

.notification.error {
    border-left: 4px solid var(--warning);
}

.notification.info {
    border-left: 4px solid var(--primary);
}

.notification-close {
    background: none;
    border: none;
    cursor: pointer;
    margin-left: auto;
    color: var(--gray);
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.obrigacoes-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.obrigacoes-list .obrigacao-card {
    display: flex;
    flex-direction: row;
    max-width: 100%;
}

.obrigacoes-list .card-header,
.obrigacoes-list .card-content,
.obrigacoes-list .card-footer {
    flex: 1;
    border: none;
}

.obrigacoes-list .card-footer {
    border-top: none;
    justify-content: flex-end;
}

.obrigacoes-calendar {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 10px;
}

.obrigacoes-calendar .obrigacao-card {
    min-height: 100px;
    font-size: 12px;
}

.obrigacoes-calendar .card-title {
    font-size: 12px;
}

.obrigacoes-calendar .card-subtitle,
.obrigacoes-calendar .card-preview {
    display: none;
}

.stats-container {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

.charts-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.chart-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: var(--card-shadow);
    height: 320px;
}

.chart-card canvas {
    flex: 1;
    width: 100% !important;
    height: 100% !important;
    max-height: 200px;
    margin-top: 10px;
}


.chart-header {
    display: flex;
    justify-content: between;
    align-items: center;
    margin-bottom: 15px;
}

.chart-header.vertical {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
    margin-bottom: 15px;
}

.chart-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--dark);
    display: flex;
    align-items: center;
    gap: 8px;
}

.chart-actions {
    display: flex;
    gap: 10px;
}

.period-select {
    padding: 5px 10px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 12px;
}

.stats-sidebar {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.stat-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: var(--card-shadow);
}

.stat-number {
    font-size: 32px;
    font-weight: bold;
    color: var(--primary);
    margin-bottom: 5px;
}

.stat-label {
    font-size: 14px;
    color: #2c3e50;
    margin-bottom: 10px;
}

.stat-progress {
    height: 6px;
    background: #f0f0f0;
    border-radius: 3px;
    overflow: hidden;
    margin-bottom: 10px;
}

.progress-bar {
    height: 100%;
    background: var(--primary);
    border-radius: 3px;
    transition: width 0.5s ease;
}

.stat-trend {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 12px;
    color: var(--gray);
}

.trend-up {
    color: #2ecc71;
}

.trend-down {
    color: #e74c3c;
}

.templates-section {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: var(--card-shadow);
    margin-bottom: 20px;
}

.templates-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.templates-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 15px;
}

.template-card {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    border-left: 4px solid var(--primary);
    cursor: pointer;
    transition: var(--transition);
}

.template-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.template-card h4 {
    margin-bottom: 8px;
    color: var(--dark);
    font-size: 14px;
}

.template-meta {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-bottom: 10px;
}

.template-badge {
    background: var(--primary);
    color: white;
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 10px;
}

.template-actions {
    display: flex;
    gap: 5px;
    justify-content: flex-end;
}

.template-btn {
    background: rgba(255,255,255,0.8);
    border: none;
    width: 25px;
    height: 25px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 10px;
    transition: var(--transition);
}

.template-btn:hover {
    background: white;
    transform: scale(1.1);
}

.template-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
}

.template-modal-content {
    background: white;
    border-radius: 12px;
    padding: 20px;
    width: 90%;
    max-width: 500px;
    max-height: 80vh;
    overflow-y: auto;
}

.backup-section {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: var(--card-shadow);
    margin-bottom: 20px;
}

.backup-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.backup-card {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    border-left: 4px solid var(--primary);
    transition: var(--transition);
    cursor: pointer;
}

.backup-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.backup-card i {
    font-size: 24px;
    color: var(--primary);
    margin-bottom: 10px;
}

.backup-card h4 {
    margin-bottom: 5px;
    color: var(--dark);
}

.backup-card p {
    font-size: 12px;
    color: #2c3e50
}

.backup-info {
    margin-top: 20px;
    padding: 15px;
    background: #e8f4fd;
    border-radius: 8px;
    font-size: 14px;
}

.backup-info ul {
    margin: 10px 0;
    padding-left: 20px;
}

.backup-info li {
    margin-bottom: 5px;
}

.busca-avancada {
    position: relative;
}

.sugestoes-busca {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border: 1px solid #ddd;
    border-radius: 0 0 8px 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    z-index: 1000;
    max-height: 300px;
    overflow-y: auto;
    display: none;
}

.sugestao-item {
    padding: 12px 15px;
    border-bottom: 1px solid #f0f0f0;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: var(--transition);
}

.sugestao-item:hover {
    background: #f8f9fa;
}

.sugestao-item:last-child {
    border-bottom: none;
}

.sugestao-icon {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.sugestao-icon.trabalho { background: #4361ee; color: white; }
.sugestao-icon.pessoal { background: #4cc9f0; color: white; }
.sugestao-icon.saude { background: #f72585; color: white; }
.sugestao-icon.estudo { background: #3a0ca3; color: white; }

.sugestao-conteudo {
    flex: 1;
}

.sugestao-titulo {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 2px;
}

.sugestao-desc {
    font-size: 12px;
    color: #666;
}

.sugestao-meta {
    font-size: 11px;
    color: #999;
}

.filtros-avancados {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: var(--card-shadow);
    margin-bottom: 20px;
    display: none;
}

.filtros-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.filtros-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

.filtro-grupo {
    margin-bottom: 15px;
}

.filtro-grupo label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    font-size: 14px;
}

.filtro-multiselect {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 5px;
}

.filtro-checkbox {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 13px;
}

.filtro-data {
    display: flex;
    gap: 10px;
    align-items: center;
}

.filtro-data input {
    flex: 1;
}

.modo-foco {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    z-index: 9999;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.foco-container {
    background: white;
    border-radius: 12px;
    padding: 30px;
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
}

.foco-header {
    text-align: center;
    margin-bottom: 20px;
}

.foco-timer {
    font-size: 48px;
    font-weight: bold;
    color: var(--primary);
    text-align: center;
    margin: 20px 0;
}

.foco-obrigacao {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
}

.foco-obrigacao h3 {
    margin-bottom: 10px;
    color: var(--dark);
}

.foco-acoes {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-top: 20px;
}

.foco-btn {
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    transition: var(--transition);
}

.foco-btn.primary {
    background: var(--primary);
    color: white;
}

.foco-btn.secondary {
    background: #6c757d;
    color: white;
}

.foco-btn:hover {
    transform: translateY(-2px);
}

.contador-produtividade {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--primary);
    color: white;
    padding: 10px 15px;
    border-radius: 20px;
    font-size: 14px;
    z-index: 1000;
    display: none;
}

.status-badge {
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 10px;
    font-weight: bold;
}

.status-pendente { background: #ffebee; color: #c62828; }
.status-andamento { background: #fff3e0; color: #ef6c00; }
.status-concluido { background: #e8f5e9; color: #2e7d32; }

.metas-section {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: var(--card-shadow);
    margin-bottom: 20px;
}

.metas-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.metas-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.meta-card {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 20px;
    border-left: 4px solid var(--primary);
    transition: var(--transition);
}

.meta-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.meta-card.completa {
    border-left-color: #2ecc71;
    background: linear-gradient(90deg, #f0fff4, #f8f9fa);
}

.meta-card.expirada {
    border-left-color: #e74c3c;
    background: linear-gradient(90deg, #ffeaea, #f8f9fa);
}

.meta-progresso {
    height: 8px;
    background: #e9ecef;
    border-radius: 4px;
    margin: 15px 0;
    overflow: hidden;
}

.meta-progresso-bar {
    height: 100%;
    background: var(--primary);
    border-radius: 4px;
    transition: width 0.5s ease;
}

.meta-card.completa .meta-progresso-bar {
    background: #2ecc71;
}

.meta-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.meta-titulo {
    font-weight: 600;
    font-size: 16px;
    margin-bottom: 5px;
}

.meta-descricao {
    font-size: 14px;
    color: #666;
    margin-bottom: 10px;
}

.meta-detalhes {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    color: #888;
}

.meta-acoes {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

.meta-btn {
    padding: 6px 12px;
    border: none;
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
    transition: var(--transition);
}

.meta-btn.primary {
    background: var(--primary);
    color: white;
}

.meta-btn.secondary {
    background: #6c757d;
    color: white;
}

.meta-btn:hover {
    transform: translateY(-1px);
}

.meta-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.meta-stat {
    background: white;
    border-radius: 8px;
    padding: 15px;
    text-align: center;
    border: 1px solid #e9ecef;
}

.meta-stat-number {
    font-size: 24px;
    font-weight: bold;
    color: var(--primary);
    margin-bottom: 5px;
}

.meta-stat-label {
    font-size: 12px;
    color: #666;
}

.meta-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
}

.meta-modal-content {
    background: white;
    border-radius: 12px;
    padding: 20px;
    width: 90%;
    max-width: 500px;
    max-height: 80vh;
    overflow-y: auto;
}

.meta-form-group {
    margin-bottom: 15px;
}

.meta-form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    font-size: 14px;
}

.meta-tipo-opcoes {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    margin-top: 10px;
}

.meta-tipo-opcao {
    border: 2px solid #e9ecef;
    border-radius: 8px;
    padding: 15px;
    text-align: center;
    cursor: pointer;
    transition: var(--transition);
}

.meta-tipo-opcao.selecionada {
    border-color: var(--primary);
    background: #f0f4ff;
}

.meta-tipo-opcao i {
    font-size: 24px;
    color: var(--primary);
    margin-bottom: 8px;
}

.meta-tipo-opcao h4 {
    margin-bottom: 5px;
    font-size: 14px;
}

.meta-tipo-opcao p {
    font-size: 12px;
    color: #666;
}

.meta-status {
    padding: 3px 8px;
    border-radius: 10px;
    font-size: 10px;
    font-weight: bold;
}

.meta-status.ativa { background: #e8f5e9; color: #2e7d32; }
.meta-status.completa { background: #4caf50; color: white; }
.meta-status.expirada { background: #ffebee; color: #c62828; }


body.dark-mode {
    background-color: #121212;
    color: #ffffff;
}

body.dark-mode header {
    background: linear-gradient(120deg, #1e3c72, #730594);
    color: white;
}

body.dark-mode .form-group-atalhos {
    background: #2d2d2d;
    color: #e0e6f6;
    border: 1px solid #444;
}

body.dark-mode .btn-outline-b { 
    background: #3a4361;
    border: none;
    color: #e0e6f6;
    transition: background 0.2s;
}
body.dark-mode .btn-outline-b:hover {
    background: #4361ee;
    color: #fff;
}

body.dark-mode .sidebar,
body.dark-mode .filters{
    background-color: #1e1e1e;
    color: #ffffff;
}
body.dark-mode .obrigacao-card{
    background: linear-gradient(120deg, #1e1e1e 60%, #2c3e50 100%);
    border-left: 4px solid #4361ee;
}
body.dark-mode .modal-content,
body.dark-mode .dashboard,
body.dark-mode .card-edit-mode{
    background-color: #1e1e1e;
    color: #ffffff;
    border-color: #333;
}
body.dark-mode .templates-section,
body.dark-mode .backup-section,
body.dark-mode .metas-section,
body.dark-mode .filtros-avancados,
body.dark-mode .foco-container,
body.dark-mode .template-modal-content,
body.dark-mode .meta-modal-content,
body.dark-mode .chart-card,
body.dark-mode .stat-card,
body.dark-mode .meta-stat {
    background-color: #1e1e1e;
    color: #ffffff;
    border-color: #333;
}

body.dark-mode .stat-label {
    color: #ffffff;
}
body.dark-mode .stat-trend { 
    color: #ffffff;
}          

body.dark-mode .dashboard-card {
    background: #2d2d2d;
}

body.dark-mode input,
body.dark-mode textarea,
body.dark-mode select {
    background-color: #2d2d2d;
    color: #ffffff;
    border-color: #444;
}

body.dark-mode input::placeholder,
body.dark-mode textarea::placeholder {
    color: #ffffff;
}

body.dark-mode .card-header,
body.dark-mode .card-footer,
body.dark-mode .modal-header,
body.dark-mode .modal-footer {
    border-color: #333;
}

body.dark-mode .card-title,   
body.dark-mode .card-preview,
body.dark-mode .card-subtitle {
    color: #fff;
}

body.dark-mode .notification {
    background-color: #2d2d2d;
    color: #ffffff;
}

body.dark-mode label,
body.dark-mode .sidebar-section h3,
body.dark-mode .modal-title,
body.dark-mode .modal-section h3,
body.dark-mode .dashboard-label,
body.dark-mode .chart-title,
body.dark-mode .meta-titulo {
    color: #ffffff;
}

body.dark-mode .dashboard-number {
    color: #ffffff;
}

body.dark-mode .checkbox-label {
    background: #2d2d2d;
    color: #ffffff;
}

body.dark-mode .checkbox-label:hover {
    background: #3d3d3d;
}

body.dark-mode .card-tag {
    background: #3a4361;
    color: #ffffff;
}

body.dark-mode .card-btn { 
    border: 1px solid #4361ee;
    color: #0037cf;
    background: transparent;
}

body.dark-mode .card-btn:hover {
    background: #4361ee;
    color: #fff;
}

body.dark-mode .step-item,
body.dark-mode .link-item {
    border-color: #333;
}

body.dark-mode .view-btn {
    background: #2d2d2d;
    color: #ffffff;
}

body.dark-mode .view-btn.active {
    background: #2d2d2d;
    color: white;
}

body.dark-mode .template-card {
    background: #2d2d2d;
}

body.dark-mode .template-card h4 {
    color: #ffffff;
}

body.dark-mode .backup-card {
    background: #2d2d2d; 
}

body.dark-mode .backup-card h4 {
    color: #ffffff;
}

body.dark-mode .backup-card p,
body.dark-mode .meta-descricao,
body.dark-mode .meta-stat-label,
body.dark-mode .meta-detalhes{
    color: #fff;
}

body.dark-mode .backup-info {
    background: #2d3a4b;
}

body.dark-mode .sugestoes-busca,
body.dark-mode .filtros-avancados {
    background: #1e1e1e;
    color: #ffffff;
}

body.dark-mode .sugestao-item:hover {
    background: #2d2d2d;
}

body.dark-mode .foco-obrigacao {
    background: #2d2d2d;
}

body.dark-mode .foco-obrigacao h3 {
    color: #ffffff;
}

body.dark-mode .meta-card {
    background: #2d2d2d;
}

body.dark-mode .meta-titulo {
    color: #ffffff;
}

body.dark-mode .meta-progresso {
    background: #333;
}

body.dark-mode .meta-tipo-opcao {
    border-color: #333;
    background: #2d2d2d;
}

body.dark-mode .meta-tipo-opcao.selecionada {
    border-color: var(--primary);
    background: #2d3a4b;
}

body.dark-mode .period-select {
    background-color: #2d2d2d;
    color: #ffffff;
    border-color: #444;
}

.card-vencimento {
    padding: 5px 10px;
    border-radius: 4px;
    font-size: 12px;
    margin-bottom: 10px;
    font-weight: bold;
}

.vencido {
    background-color: #ffebee;
    color: #c62828;
}

.hoje {
    background-color: #fff8e1;
    color: #f57f17;
}

.proximo {
    background-color: #e8f5e9;
    color: #2e7d32;
}

.texto-vencido {
    color: #c62828;
    font-weight: bold;
}

.texto-hoje {
    color: #f57f17;
    font-weight: bold;
}

.texto-proximo {
    color: #2e7d32;
    font-weight: bold;
}

body.dark-mode .vencido {
    background-color: #c62828;
    color: #ffffff;
}

body.dark-mode .hoje {
    background-color: #f57f17;
    color: #ffffff;
}

body.dark-mode .proximo {
    background-color: #2e7d32;
    color: #ffffff;
}


.lote-checkbox {
    accent-color: var(--primary);
    width: 18px;
    height: 18px;
    margin-right: 8px;
    vertical-align: middle;
    cursor: pointer;
}

.obrigacao-card.excluida {
    opacity: 0.6;
    border-left: 4px solid #e74c3c;
    background: linear-gradient(90deg, #ffeaea, #f8f9fa);
}
body.dark-mode .obrigacao-card.excluida {
    background: linear-gradient(90deg, #2d2d2d, #c62828);
}

.lote-actions {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-top: 20px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
}

.obrigacao-card.selecionada {
    box-shadow: 0 0 0 2px var(--primary);
    transform: scale(1.02);
}

.template-recursivo {
    border-left: 4px solid #f72585 !important;
}

.template-recursivo .template-badge {
    background: #f72585;
}

.modo-recuperacao .obrigacao-card:not(.excluida) {
    display: none;
}

.modo-recuperacao .header-actions .btn:not([onclick*="mostrarRecuperacaoObrigacoes"]) {
    opacity: 0.6;
    pointer-events: none;
}

.badge-recursivo {
    background: #f72585 !important;
    color: white;
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 10px;
    margin-left: 5px;
}

.recorrencia-avancada {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    margin-top: 10px;
    border: 1px solid #e9ecef;
}

.recorrencia-avancada h4 {
    margin-bottom: 10px;
    font-size: 14px;
    color: #2c3e50;
}

body.dark-mode .recorrencia-avancada {
    background: #2d2d2d;
    border-color: #444;
}

body.dark-mode .recorrencia-avancada h4 {
    color: #ffffff;
}

.meta-progresso-indicator {
    display: flex;
    justify-content: space-between;
    font-size: 11px;
    color: #666;
    margin-top: 5px;
}

body.dark-mode .meta-progresso-indicator {
    color: #cccccc;
}

.notification.warning {
    border-left: 4px solid var(--warning);
}

.notification.system {
    border-left: 4px solid var(--gray);
}

.quick-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin: 10px 0;
}

.quick-action-btn {
    background: var(--primary);
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 12px;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 5px;
}

.quick-action-btn:hover {
    background: var(--secondary);
    transform: translateY(-1px);
}

.stat-advanced {
    background: white;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 10px;
    border-left: 4px solid var(--primary);
}

body.dark-mode .stat-advanced {
    background: #2d2d2d;
}

.stat-advanced .stat-title {
    font-size: 12px;
    color: #666;
    margin-bottom: 5px;
}

body.dark-mode .stat-advanced .stat-title {
    color: #cccccc;
}

.stat-advanced .stat-value {
    font-size: 18px;
    font-weight: bold;
    color: var(--primary);
}


@media (max-width: 992px) {
    .container {
        grid-template-columns: 1fr;
    }
    
    .sidebar {
        order: 2;
    }
    
    .main-content {
        order: 1;
    }

    .stats-container {
        grid-template-columns: 1fr;
    }

    .charts-grid {
        grid-template-columns: 1fr;
    }
    
    .lote-actions {
        flex-direction: column;
    }
    
    .quick-actions {
        justify-content: center;
    }
}

@media (max-width: 768px) {
    .filters {
        flex-direction: column;
    }

    .search-box {
        min-width: 100%;
    }

    .templates-grid {
        grid-template-columns: 1fr;
    }

    .metas-container {
        grid-template-columns: 1fr;
    }

    .backup-actions {
        grid-template-columns: 1fr;
    }

    .meta-tipo-opcoes {
        grid-template-columns: 1fr;
    }
    
    .header-actions {
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .obrigacoes-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 576px) {
    header {
        flex-direction: column;
        gap: 15px;
        text-align: center;
    }
    
    .filters {
        flex-direction: column;
        align-items: stretch;
    }
    
    .obrigacoes-grid {
        grid-template-columns: 1fr;
    }
    
    .dashboard {
        grid-template-columns: 1fr;
    }
    
    .obrigacoes-list .obrigacao-card {
        flex-direction: column;
    }
    
    .obrigacoes-calendar {
        grid-template-columns: 1fr;
    }

    .foco-container {
        padding: 20px;
    }

    .foco-timer {
        font-size: 36px;
    }

    .meta-stats {
        grid-template-columns: 1fr 1fr;
    }
    
    .card-actions {
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .lote-checkbox {
        width: 20px;
        height: 20px;
    }
    
    .quick-actions {
        flex-direction: column;
    }
    
    .quick-action-btn {
        justify-content: center;
    }
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.pulse {
    animation: pulse 0.5s ease-in-out;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.slide-down {
    animation: slideDown 0.3s ease-out;
}

.loading {
    opacity: 0.6;
    pointer-events: none;
    position: relative;
}

.loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 20px;
    height: 20px;
    margin: -10px 0 0 -10px;
    border: 2px solid #f3f3f3;
    border-top: 2px solid var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>
</head>
<body>
    <header>
        <div class="logo">
            <i class="fas fa-tasks"></i>
            <h1>Sistema de Obrigações Diárias</h1>
        </div>
        <div class="header-actions">
            <button class="btn btn-outline-A" onclick="toggleModoEscuro()">
                <i class="fas fa-moon"></i> Modo Escuro
            </button>
            <button class="btn" onclick="mostrarAjuda()">
                <i class="fas fa-question-circle"></i> Ajuda
            </button>
            <button class="btn" onclick="ativarExclusaoLote()">
                <i class="fas fa-trash"></i> Excluir em Lote
            </button>
            <button class="btn" onclick="mostrarRecuperacaoObrigacoes()">
                <i class="fas fa-history"></i> Recuperar Excluídas
            </button>
        </div>
    </header>

    <div class="container">
        <div class="sidebar">
            <h2>Nova Obrigação</h2>
            <form id="novaObrigacaoForm">
                <div class="form-group">
                    <label for="tipoObrigacao"> Titulo</label>
                    <input type="text" id="tipoObrigacao" placeholder="Ex: Fechamento BAAS">
                </div>
                
                <div class="form-group">
                    <label for="descricao"> Descrição</label>
                    <textarea id="descricao" placeholder="Descreva sua obrigação..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="categoria"> Categoria</label>
                    <select id="categoria">
                        <option value="trabalho">Trabalho</option>
                        <option value="pessoal">Pessoal</option>
                        <option value="estudos">Estudos</option>
                        <option value="saude">Saúde</option>
                        <option value="financeiro">Financeiro</option>
                        <option value="outros" selected>Outros</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="prioridade">Prioridade</label>
                    <select id="prioridade">
                        <option value="baixa">Baixa</option>
                        <option value="media" selected>Média</option>
                        <option value="alta">Alta</option>
                        <option value="urgente">Urgente</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="status">Status</label>
                    <select id="status">
                        <option value="pendente">Pendente</option>
                        <option value="andamento">Em Andamento</option>
                        <option value="concluido">Concluído</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="dataParaFazer">Data para Fazer</label>
                    <input type="date" id="dataParaFazer">
                </div>
                
                <div class="form-group">
                    <label for="dataLembrete">Data para Lembrete</label>
                    <input type="date" id="dataLembrete">
                </div>
                
                <div class="form-group">
                    <label for="dataVencimento">Data de Vencimento</label>
                    <input type="date" id="dataVencimento">
                </div>
                
                <div class="form-group">
                    <label for="recorrencia">Recorrência</label>
                    <select id="recorrencia">
                        <option value="nenhuma">Nenhuma</option>
                        <option value="diaria">Diária</option>
                        <option value="semanal">Semanal</option>
                        <option value="quinzenal">Quinzenal</option>
                        <option value="mensal">Mensal</option>
                        <option value="anual">Anual</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Meses de Atividade</label>
                    <div class="checkbox-group" id="mesesAtividade">
                        <label class="checkbox-label"><input type="checkbox" value="1"> Jan</label>
                        <label class="checkbox-label"><input type="checkbox" value="2"> Fev</label>
                        <label class="checkbox-label"><input type="checkbox" value="3"> Mar</label>
                        <label class="checkbox-label"><input type="checkbox" value="4"> Abr</label>
                        <label class="checkbox-label"><input type="checkbox" value="5"> Mai</label>
                        <label class="checkbox-label"><input type="checkbox" value="6"> Jun</label>
                        <label class="checkbox-label"><input type="checkbox" value="7"> Jul</label>
                        <label class="checkbox-label"><input type="checkbox" value="8"> Ago</label>
                        <label class="checkbox-label"><input type="checkbox" value="9"> Set</label>
                        <label class="checkbox-label"><input type="checkbox" value="10"> Out</label>
                        <label class="checkbox-label"><input type="checkbox" value="11"> Nov</label>
                        <label class="checkbox-label"><input type="checkbox" value="12"> Dez</label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Passo a Passo* (use >> para subpassos)</label>
                    <textarea id="passos" required placeholder="Ex: 
1. Acessar o site
>> www.exemplo.com
2. Preencher formulário
>> Clicar em 'Enviar'
3. Finalizar"></textarea>
                </div>

                <div class="form-group">
                    <label>Links Úteis</label>
                    <div class="tag-input">
                        <input type="text" id="linkTitulo" placeholder="Título do link">
                        <input type="url" id="linkUrl" placeholder="URL">
                        <button type="button" class="btn" id="btnAddLink">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div id="linksList" class="tag-list"></div>
                </div>

                <div class="form-group-atalhos">
                    <h3><i class="fas fa-bolt"></i> Atalhos Rápidos</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <button class="btn btn-outline-B" onclick="filtrarPorPrioridade('urgente')">
                            <i class="fas fa-exclamation-triangle"></i> Urgentes
                        </button>
                        <button class="btn btn-outline-B" onclick="filtrarPorStatus('pendente')">
                            <i class="fas fa-clock"></i> Pendentes
                        </button>
                        <button class="btn btn-outline-B" onclick="limparFiltros()">
                            <i class="fas fa-eraser"></i> Limpar Filtros
                        </button>
                        <button class="btn btn-outline-B" onclick="exportarDados('json')">
                            <i class="fas fa-download"></i> Backup
                        </button>
                    </div>
                </div>    

                    <div class="form-group">
                        <label for="imagemUpload">Adicionar Print</label>
                        <input type="file" id="imagemUpload" accept="image/*">
                        <div class="image-preview" id="imagePreview"></div>
                    </div>

                    <button class="btn" onclick="adicionarObrigacao()" style="width: 100%;">
                        <i class="fas fa-plus"></i> Adicionar Obrigação
                    </button>
                    <button type="button" class="btn" id="btnCancelar" style="width: 100%; margin-top: 10px; display: none;">
                        <i class="fas fa-times"></i> Cancelar Edição
                </button>                
            </form>
        </div>

        <div class="main-content">
            <div class="dashboard" id="dashboard">
                <div class="dashboard-card">
                    <div class="dashboard-number" id="totalObrigacoes">0</div>
                    <div class="dashboard-label">Total de Obrigações</div>
                </div>
                <div class="dashboard-card">
                    <div class="dashboard-number" id="obrigacoesPendentes">0</div>
                    <div class="dashboard-label">Pendentes</div>
                </div>
                <div class="dashboard-card">
                    <div class="dashboard-number" id="obrigacoesAndamento">0</div>
                    <div class="dashboard-label">Em Andamento</div>
                </div>
                <div class="dashboard-card">
                    <div class="dashboard-number" id="obrigacoesConcluidas">0</div>
                    <div class="dashboard-label">Concluídas</div>
                </div>
                <div class="dashboard-card">
                    <div class="dashboard-number" id="obrigacoesVencidas">0</div>
                    <div class="dashboard-label">Vencidas</div>
                </div>
            </div>

            <div class="filters">
                <div class="busca-avancada">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="search-input" placeholder="Buscar obrigações, categorias, tags...">
                    </div>
                    <div class="sugestoes-busca" id="sugestoesBusca"></div>
                </div>
                
                <select class="filter-select" id="filter-categoria">
                    <option value="">Todas as categorias</option>
                        <option value="trabalho">Trabalho</option>
                        <option value="pessoal">Pessoal</option>
                        <option value="estudo">Estudo</option>
                        <option value="saude">Saúde</option>
                        <option value="financeiro">Financeiro</option>
                        <option value="outro">Outro</option>
                </select>
                
                <select class="filter-select" id="filter-prioridade">
                    <option value="">Todas as prioridades</option>
                    <option value="urgente">Urgente</option>
                    <option value="alta">Alta</option>
                    <option value="media">Média</option>
                    <option value="baixa">Baixa</option>
                </select>
                
                <select class="filter-select" id="filter-status">
                    <option value="">Todos os status</option>
                    <option value="pendente">Pendente</option>
                    <option value="andamento">Em andamento</option>
                    <option value="concluido">Concluído</option>
                </select>
                
                <div class="view-options">
                    <button class="view-btn active" data-view="grid" title="Visualização em Grid">
                        <i class="fas fa-th"></i>
                    </button>
                    <button class="view-btn" data-view="list" title="Visualização em Lista">
                        <i class="fas fa-list"></i>
                    </button>
                    <button class="view-btn" data-view="calendar" title="Visualização em Calendário">
                        <i class="fas fa-calendar"></i>
                    </button>
                    <button class="view-btn" id="btnFiltrosAvancados" title="Filtros Avançados">
                        <i class="fas fa-filter"></i>
                    </button>
                    <button class="view-btn" id="btnModoFoco" title="Modo Foco">
                        <i class="fas fa-crosshairs"></i>
                    </button>
                </div>
            </div>

            <div class="filtros-avancados" id="filtrosAvancados">
                <div class="filtros-header">
                    <h4><i class="fas fa-sliders-h"></i> Filtros Avançados</h4>
                    <button class="btn btn-outline" onclick="fecharFiltrosAvancados()">
                        <i class="fas fa-times"></i> Fechar
                    </button>
                </div>
                
                <div class="filtros-grid">
                    <div class="filtro-grupo">
                        <label><i class="fas fa-calendar"></i> Período</label>
                        <div class="filtro-data">
                            <input type="date" id="filtroDataInicio" placeholder="Data inicial">
                            <span>até</span>
                            <input type="date" id="filtroDataFim" placeholder="Data final">
                        </div>
                    </div>
                    
                    <div class="filtro-grupo">
                        <label><i class="fas fa-tags"></i> Tags (palavras-chave)</label>
                        <input type="text" id="filtroTags" placeholder="Ex: imposto, reunião, estudo">
                    </div>
                    
                    <div class="filtro-grupo">
                        <label><i class="fas fa-bolt"></i> Status Múltiplo</label>
                        <div class="filtro-multiselect">
                            <label class="filtro-checkbox">
                                <input type="checkbox" name="filtroStatusMultiplo" value="pendente" checked> Pendente
                            </label>
                            <label class="filtro-checkbox">
                                <input type="checkbox" name="filtroStatusMultiplo" value="andamento" checked> Em Andamento
                            </label>
                            <label class="filtro-checkbox">
                                <input type="checkbox" name="filtroStatusMultiplo" value="concluido"> Concluído
                            </label>
                        </div>
                    </div>
                    
                    <div class="filtro-grupo">
                        <label><i class="fas fa-sort-amount-down"></i> Ordenar por</label>
                        <select id="filtroOrdenacao">
                            <option value="data-criacao">Data de Criação (Mais Recente)</option>
                            <option value="data-vencimento">Data de Vencimento</option>
                            <option value="prioridade">Prioridade</option>
                            <option value="titulo">Título (A-Z)</option>
                        </select>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button class="btn btn-outline" onclick="limparFiltrosAvancados()">
                        <i class="fas fa-eraser"></i> Limpar Filtros
                    </button>
                    <button class="btn" onclick="aplicarFiltrosAvancados()">
                        <i class="fas fa-check"></i> Aplicar Filtros
                    </button>
                </div>
            </div>

            <section class="obrigacoes-grid" id="obrigacoesContainer">
            </section>

            <section class="templates-section">
                <div class="templates-header">
                    <h3><i class="fas fa-clone"></i> Modelo de Obrigações</h3>
                    <button class="btn" onclick="abrirModalTemplate()">
                        <i class="fas fa-plus"></i> Novo Template
                    </button>
                </div>
                
                <div class="templates-grid" id="templates-container">
                </div>
            </section>

            <section class="metas-section">
                <div class="metas-header">
                    <h3><i class="fas fa-bullseye"></i> Metas e Objetivos</h3>
                    <button class="btn" onclick="abrirModalMeta()">
                        <i class="fas fa-plus"></i> Nova Meta
                    </button>
                </div>
                
                <div class="meta-stats">
                    <div class="meta-stat">
                        <div class="meta-stat-number" id="totalMetas">0</div>
                        <div class="meta-stat-label">Total de Metas</div>
                    </div>
                    <div class="meta-stat">
                        <div class="meta-stat-number" id="metasCompletas">0</div>
                        <div class="meta-stat-label">Metas Concluídas</div>
                    </div>
                    <div class="meta-stat">
                        <div class="meta-stat-number" id="taxaSucesso">0%</div>
                        <div class="meta-stat-label">Taxa de Sucesso</div>
                    </div>
                    <div class="meta-stat">
                        <div class="meta-stat-number" id="diasConsecutivos">0</div>
                        <div class="meta-stat-label">Dias Consecutivos</div>
                    </div>
                </div>
                
                <div class="metas-container" id="metasContainer">
                </div>
            </section>

            <section class="backup-section">
                <h3><i class="fas fa-database"></i> Backup e Exportação de Dados</h3>
                <p style="margin-bottom: 15px; color: #666;">Faça backup dos seus dados ou exporte para usar em outro dispositivo.</p>
                
                <div class="backup-actions">
                    <div class="backup-card" onclick="exportarDados('json')">
                        <i class="fas fa-file-export"></i>
                        <h4>Exportar JSON</h4>
                        <p>Salve todos os dados em um arquivo JSON</p>
                    </div>
                    
                    <div class="backup-card" onclick="exportarDados('csv')">
                        <i class="fas fa-table"></i>
                        <h4>Exportar CSV</h4>
                        <p>Formato compatível com planilhas</p>
                    </div>
                    
                    <div class="backup-card" onclick="importarDados()">
                        <i class="fas fa-file-import"></i>
                        <h4>Importar Dados</h4>
                        <p>Restaurar de um backup anterior</p>
                    </div>
                    
                    <div class="backup-card" onclick="criarBackupAutomatico()">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <h4>Backup na Nuvem</h4>
                        <p>Salve online (simulação)</p>
                    </div>
                </div>
                
                <div class="backup-info">
                    <strong><i class="fas fa-info-circle"></i> Informações do Backup</strong>
                    <ul>
                        <li>Último backup: <span id="ultimoBackup">Nunca</span></li>
                        <li>Total de obrigações: <span id="totalBackupObrigacoes">0</span></li>
                        <li>Total de templates: <span id="totalBackupTemplates">0</span></li>
                        <li>Espaço utilizado: <span id="espacoUtilizado">0 KB</span></li>
                    </ul>
                    <button class="btn" onclick="limparDados()" style="background: var(--warning);">
                        <i class="fas fa-trash"></i> Limpar Todos os Dados
                    </button>
                </div>
                
                <input type="file" id="importFile" accept=".json,.csv" style="display: none;">
            </section>

            <section class="stats-container">
                <div class="charts-grid">
                    <div class="chart-card">
                        <div class="chart-header vertical">
                            <span class="chart-title">
                                <i class="fas fa-chart-pie"></i> Distribuição por Categoria
                            </span>
                            <select class="period-select" id="chart-period">
                                <option value="week">Esta Semana</option>
                                <option value="month" selected>Este Mês</option>
                                <option value="year">Este Ano</option>
                            </select>
                        </div>
                        <canvas id="categoryChart"></canvas>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title">
                                <i class="fas fa-chart-bar"></i> Progresso Semanal
                            </div>
                        </div>
                        <canvas id="progressChart"></canvas>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title">
                                <i class="fas fa-flag"></i> Distribuição por Prioridade
                            </div>
                        </div>
                        <canvas id="priorityChart"></canvas>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title">
                                <i class="fas fa-trend-up"></i> Taxa de Conclusão
                            </div>
                        </div>
                        <canvas id="completionChart"></canvas>
                    </div>
                </div>
                
                <div class="stats-sidebar">
                    <div class="stat-card">
                        <div class="stat-number" id="totalTasks">0</div>
                        <div class="stat-label">Total de Obrigações</div>
                        <div class="stat-trend trend-up">
                            <i class="fas fa-arrow-up"></i> <span id="totalTrend">0%</span> em relação ao mês passado
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-number" id="completedTasks">0</div>
                        <div class="stat-label">Concluídas</div>
                        <div class="stat-progress">
                            <div class="progress-bar" id="completionBar" style="width: 0%"></div>
                        </div>
                        <div class="stat-trend">
                            <i class="fas fa-chart-line"></i> <span id="completionRate">0%</span> taxa de conclusão
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-number" id="pendingTasks">0</div>
                        <div class="stat-label">Pendentes</div>
                        <div class="stat-trend trend-down">
                            <i class="fas fa-clock"></i> <span id="pendingUrgent">0</span> urgentes
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-number" id="productivityScore">0</div>
                        <div class="stat-label">Pontuação de Produtividade</div>
                        <div class="stat-progress">
                            <div class="progress-bar" id="productivityBar" style="width: 0%"></div>
                        </div>
                        <div class="stat-trend">
                            <i class="fas fa-star"></i> <span id="productivityLevel">Iniciante</span>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div class="modal" id="obrigacaoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitulo">Detalhes da Obrigação</h3>
                <button class="modal-close" onclick="fecharModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalCorpo">
            </div>
            <div class="modal-footer" id="modalFooter">
                <button class="btn btn-outline" onclick="fecharModal()">Fechar</button>
                <button class="btn" id="btnEditarModal">Editar</button>
                <button class="btn" id="btnConcluirModal" style="background: var(--success);">Marcar como Concluída</button>
            </div>
        </div>
    </div>

    <div class="template-modal" id="templateModal">
        <div class="template-modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="templateModalTitle">Novo Template</h3>
                <button class="modal-close" onclick="fecharModalTemplate()">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="form-group">
                    <label for="templateNome"><i class="fas fa-heading"></i> Nome do Template</label>
                    <input type="text" id="templateNome" placeholder="Ex: Reunião Semanal">
                </div>
                
                <div class="form-group">
                    <label for="templateDescricao"><i class="fas fa-align-left"></i> Descrição</label>
                    <textarea id="templateDescricao" placeholder="Descrição da obrigação..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="templateCategoria"><i class="fas fa-tag"></i> Categoria</label>
                    <select id="templateCategoria">
                        <option value="trabalho">Trabalho</option>
                        <option value="pessoal">Pessoal</option>
                        <option value="estudo">Estudo</option>
                        <option value="saude">Saúde</option>
                        <option value="financeiro">Financeiro</option>
                        <option value="outro">Outro</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="templatePrioridade"><i class="fas fa-flag"></i> Prioridade</label>
                    <select id="templatePrioridade">
                        <option value="baixa">Baixa</option>
                        <option value="media" selected>Média</option>
                        <option value="alta">Alta</option>
                        <option value="urgente">Urgente</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="templateRecorrencia"><i class="fas fa-redo"></i> Recorrência</label>
                    <select id="templateRecorrencia">
                        <option value="nenhuma">Nenhuma</option>
                        <option value="diaria">Diária</option>
                        <option value="semanal">Semanal</option>
                        <option value="mensal">Mensal</option>
                        <option value="anual">Anual</option>
                    </select>
                </div>
                
                <div class="form-group" id="templateDiasContainer" style="display: none;">
                    <label><i class="fas fa-calendar-week"></i> Dias da Semana</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="templateDias" value="1"> Segunda
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="templateDias" value="2"> Terça
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="templateDias" value="3"> Quarta
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="templateDias" value="4"> Quinta
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="templateDias" value="5"> Sexta
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="templateDias" value="6"> Sábado
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="templateDias" value="0"> Domingo
                        </label>
                    </div>
                </div>

                <div class="form-group" id="templateSemanasContainer" style="display: none;">
                    <label><i class="fas fa-calendar-week"></i> Quantidade de Semanas</label>
                    <input type="number" id="templateSemanas" min="1" max="52" value="1">
                </div>

                <div class="form-group" id="templateMesesContainer" style="display: none;">
                    <label><i class="fas fa-calendar-alt"></i> Meses para repetir</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label"><input type="checkbox" value="1"> Jan</label>
                        <label class="checkbox-label"><input type="checkbox" value="2"> Fev</label>
                        <label class="checkbox-label"><input type="checkbox" value="3"> Mar</label>
                        <label class="checkbox-label"><input type="checkbox" value="4"> Abr</label>
                        <label class="checkbox-label"><input type="checkbox" value="5"> Mai</label>
                        <label class="checkbox-label"><input type="checkbox" value="6"> Jun</label>
                        <label class="checkbox-label"><input type="checkbox" value="7"> Jul</label>
                        <label class="checkbox-label"><input type="checkbox" value="8"> Ago</label>
                        <label class="checkbox-label"><input type="checkbox" value="9"> Set</label>
                        <label class="checkbox-label"><input type="checkbox" value="10"> Out</label>
                        <label class="checkbox-label"><input type="checkbox" value="11"> Nov</label>
                        <label class="checkbox-label"><input type="checkbox" value="12"> Dez</label>
                </div>

                <div class="form-group" id="templateAnosContainer" style="display: none;">
                        <label><i class="fas fa-calendar"></i> Anos para repetir</label>
                        <input type="text" id="templateAnos" placeholder="Ex: 2025,2026,2027">
                </div>
            
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="fecharModalTemplate()">Cancelar</button>
                <button class="btn" id="templateSalvarBtn" onclick="salvarTemplate()">Salvar Template</button>
            </div>
        </div>
    </div>

    <div class="meta-modal" id="metaModal">
        <div class="meta-modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="metaModalTitle">Nova Meta</h3>
                <button class="modal-close" onclick="fecharModalMeta()">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="meta-form-group">
                    <label for="metaTitulo"><i class="fas fa-heading"></i> Título da Meta</label>
                    <input type="text" id="metaTitulo" placeholder="Ex: Concluir 10 obrigações esta semana">
                </div>
                
                <div class="meta-form-group">
                    <label for="metaDescricao"><i class="fas fa-align-left"></i> Descrição</label>
                    <textarea id="metaDescricao" placeholder="Descreva sua meta..."></textarea>
                </div>
                
                <div class="meta-form-group">
                    <label><i class="fas fa-bullseye"></i> Tipo de Meta</label>
                    <div class="meta-tipo-opcoes">
                        <div class="meta-tipo-opcao" data-tipo="quantidade" onclick="selecionarTipoMeta('quantidade')">
                            <i class="fas fa-hashtag"></i>
                            <h4>Quantidade</h4>
                            <p>Completar X tarefas</p>
                        </div>
                        <div class="meta-tipo-opcao" data-tipo="frequencia" onclick="selecionarTipoMeta('frequencia')">
                            <i class="fas fa-calendar-check"></i>
                            <h4>Frequência</h4>
                            <p>Tarefas por período</p>
                        </div>
                    </div>
                </div>
                
                <div class="meta-form-group" id="metaQuantidadeContainer">
                    <label for="metaQuantidade"><i class="fas fa-target"></i> Quantidade Alvo</label>
                    <input type="number" id="metaQuantidade" min="1" value="5">
                </div>
                
                <div class="meta-form-group" id="metaFrequenciaContainer" style="display: none;">
                    <label for="metaFrequencia"><i class="fas fa-redo"></i> Frequência</label>
                    <select id="metaFrequencia">
                        <option value="diaria">Diária</option>
                        <option value="semanal">Semanal</option>
                        <option value="mensal">Mensal</option>
                    </select>
                </div>
                
                <div class="meta-form-group">
                    <label for="metaDataLimite"><i class="fas fa-calendar-day"></i> Data Limite</label>
                    <input type="date" id="metaDataLimite">
                </div>
                
                <div class="meta-form-group">
                    <label for="metaCategoria"><i class="fas fa-tag"></i> Categoria (Opcional)</label>
                    <select id="metaCategoria">
                        <option value="">Todas as categorias</option>
                        <option value="trabalho">Trabalho</option>
                        <option value="pessoal">Pessoal</option>
                        <option value="estudo">Estudo</option>
                        <option value="saude">Saúde</option>
                        <option value="financeiro">Financeiro</option>
                        <option value="outro">Outro</option>
                    </select>
                </div>
                
                <div class="meta-form-group">
                    <label for="metaPrioridade"><i class="fas fa-flag"></i> Prioridade (Opcional)</label>
                    <select id="metaPrioridade">
                        <option value="">Todas as prioridades</option>
                        <option value="urgente">Urgente</option>
                        <option value="alta">Alta</option>
                        <option value="media">Média</option>
                        <option value="baixa">Baixa</option>
                    </select>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="fecharModalMeta()">Cancelar</button>
                <button class="btn" id="metaSalvarBtn" onclick="salvarMeta()">Criar Meta</button>
            </div>
        </div>
    </div>

    <div class="modo-foco" id="modoFoco">
        <div class="foco-container">
            <div class="foco-header">
                <h2><i class="fas fa-crosshairs"></i> Modo Foco</h2>
                <p>Concentre-se em uma única tarefa por vez</p>
            </div>
            
            <div class="foco-timer" id="focoTimer">25:00</div>
            
            <div class="foco-obrigacao" id="focoObrigacao">
                <h3 id="focoTitulo">Selecione uma obrigação para focar</h3>
                <p id="focoDescricao">Nenhuma obrigação selecionada</p>
                <div class="foco-meta">
                    <span class="status-badge status-pendente" id="focoStatus">Pendente</span>
                    <span class="template-badge" id="focoCategoria">Trabalho</span>
                    <span class="template-badge" id="focoPrioridade">Média</span>
                </div>
            </div>
            
            <div class="foco-acoes">
                <button class="foco-btn secondary" onclick="sairModoFoco()">
                    <i class="fas fa-times"></i> Sair do Foco
                </button>
                <button class="foco-btn primary" onclick="iniciarTimerFoco()" id="btnIniciarTimer">
                    <i class="fas fa-play"></i> Iniciar Timer
                </button>
                <button class="foco-btn primary" onclick="concluirObrigacaoFoco()" id="btnConcluirFoco" style="display: none;">
                    <i class="fas fa-check"></i> Concluir
                </button>
            </div>
        </div>
    </div>

    <div class="contador-produtividade" id="contadorProdutividade">
        <i class="fas fa-clock"></i> <span id="tempoProdutivo">00:00:00</span>
    </div>

    <div class="notification-container" id="notificationContainer"></div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>

let obrigacoes = JSON.parse(localStorage.getItem('obrigacoes')) || [];
let templates = JSON.parse(localStorage.getItem('templates')) || [];
let metas = JSON.parse(localStorage.getItem('metas')) || [];
let obrigacoesExcluidas = JSON.parse(localStorage.getItem('obrigacoesExcluidas')) || [];
let modoExclusaoLote = false;
let obrigacoesSelecionadas = [];
let timerFoco = null;
let tempoRestante = 25 * 60;
let tempoProdutivo = 0;
let timerProdutividade = null;
let obrigacaoFoco = null;
let metaEditando = null;
let templateEditando = null;
let tipoMetaSelecionado = 'quantidade';
let chartCategorias = null;
let chartProgresso = null;
let chartPrioridades = null;
let chartConclusao = null;

let editandoId = null;
let currentObrigacaoId = null;


function adicionarObrigacao() {
    if (editandoId) {
        atualizarObrigacao(editandoId);
        return;
    }

    const titulo = document.getElementById('tipoObrigacao').value.trim();
    const descricao = document.getElementById('descricao').value.trim();
    const categoria = document.getElementById('categoria').value;
    const prioridade = document.getElementById('prioridade').value;
    const status = document.getElementById('status').value;
    const dataParaFazer = document.getElementById('dataParaFazer').value;
    const dataLembrete = document.getElementById('dataLembrete').value;
    const dataVencimento = document.getElementById('dataVencimento').value;
    const recorrencia = document.getElementById('recorrencia').value;

    if (!titulo) {
        mostrarNotificacao('Por favor, informe um título para a obrigação!', 'error');
        return;
    }

    const novaObrigacao = {
        id: Date.now(),
        titulo: titulo,
        descricao: descricao,
        categoria: categoria,
        prioridade: prioridade,
        status: status,
        dataCriacao: new Date().toISOString().split('T')[0],
        dataParaFazer: dataParaFazer || null,
        dataLembrete: dataLembrete || null,
        dataVencimento: dataVencimento || null,
        recorrencia: recorrencia
    };

    obrigacoes.push(novaObrigacao);
    salvarObrigacoes();
    renderizarObrigacoes();
    aplicarFiltros();
    atualizarDashboard();
    atualizarEstatisticas();

    document.getElementById('novaObrigacaoForm').reset();
    mostrarNotificacao('Obrigação adicionada com sucesso!', 'success');
}

function preencherFormularioEdicao(obrigacao) {
    document.getElementById('tipoObrigacao').value = obrigacao.titulo;
    document.getElementById('descricao').value = obrigacao.descricao || '';
    document.getElementById('categoria').value = obrigacao.categoria;
    document.getElementById('prioridade').value = obrigacao.prioridade;
    document.getElementById('status').value = obrigacao.status;
    document.getElementById('dataParaFazer').value = obrigacao.dataParaFazer || '';
    document.getElementById('dataLembrete').value = obrigacao.dataLembrete || '';
    document.getElementById('dataVencimento').value = obrigacao.dataVencimento || '';
    document.getElementById('recorrencia').value = obrigacao.recorrencia || 'nenhuma';
    
    document.getElementById('btnCancelar').style.display = 'block';
    
    const btnAdicionar = document.querySelector('button[onclick="adicionarObrigacao()"]');
    btnAdicionar.innerHTML = '<i class="fas fa-save"></i> Atualizar Obrigação';
    btnAdicionar.setAttribute('onclick', `atualizarObrigacao(${obrigacao.id})`);
}

function editarObrigacao(id) {
    const obrigacao = obrigacoes.find(o => o.id === id);
    if (!obrigacao) return;

    editandoId = id;
    currentObrigacaoId = id;
    
    preencherFormularioEdicao(obrigacao);
    
    fecharModal();
    mostrarNotificacao('Editando obrigação. Ajuste os dados e clique em "Atualizar".', 'info');
}

function atualizarObrigacao(id) {
    const obrigacaoIndex = obrigacoes.findIndex(o => o.id === id);
    if (obrigacaoIndex === -1) return;

    const titulo = document.getElementById('tipoObrigacao').value.trim();
    const descricao = document.getElementById('descricao').value.trim();
    const categoria = document.getElementById('categoria').value;
    const prioridade = document.getElementById('prioridade').value;
    const status = document.getElementById('status').value;
    const dataParaFazer = document.getElementById('dataParaFazer').value;
    const dataLembrete = document.getElementById('dataLembrete').value;
    const dataVencimento = document.getElementById('dataVencimento').value;
    const recorrencia = document.getElementById('recorrencia').value;

    if (!titulo) {
        mostrarNotificacao('Por favor, informe um título para a obrigação!', 'error');
        return;
    }

    obrigacoes[obrigacaoIndex] = {
        ...obrigacoes[obrigacaoIndex],
        titulo: titulo,
        descricao: descricao,
        categoria: categoria,
        prioridade: prioridade,
        status: status,
        dataParaFazer: dataParaFazer || null,
        dataLembrete: dataLembrete || null,
        dataVencimento: dataVencimento || null,
        recorrencia: recorrencia
    };

    salvarObrigacoes();
    renderizarObrigacoes();
    aplicarFiltros();
    atualizarDashboard();
    atualizarEstatisticas();

    cancelarEdicao();
    mostrarNotificacao('Obrigação atualizada com sucesso!', 'success');
}

function cancelarEdicao() {
    editandoId = null;
    currentObrigacaoId = null;
    
    document.getElementById('novaObrigacaoForm').reset();
    
    const btnAdicionar = document.querySelector('button[onclick="adicionarObrigacao()"]');
    btnAdicionar.innerHTML = '<i class="fas fa-plus"></i> Adicionar Obrigação';
    btnAdicionar.setAttribute('onclick', 'adicionarObrigacao()');
    
    document.getElementById('btnCancelar').style.display = 'none';    
    mostrarNotificacao('Edição cancelada.', 'info');
}

function salvarObrigacoes() {
    localStorage.setItem('obrigacoes', JSON.stringify(obrigacoes));
    atualizarDashboard();
    atualizarInfoBackup();
}

function atualizarDashboard() {
    const totalObrigacoes = obrigacoes.length;
    const obrigacoesPendentes = obrigacoes.filter(o => o.status === 'pendente').length;
    
    const obrigacoesAndamento = obrigacoes.filter(o => o.status === 'andamento').length;
    
    const obrigacoesConcluidas = obrigacoes.filter(o => o.status === 'concluido').length;
    
    const hoje = new Date().toISOString().split('T')[0];
    const obrigacoesVencidas = obrigacoes.filter(o => 
        o.dataVencimento && o.dataVencimento < hoje && o.status !== 'concluido'
    ).length;
    
    if (document.getElementById('totalObrigacoes')) {
        document.getElementById('totalObrigacoes').textContent = totalObrigacoes;
        document.getElementById('obrigacoesPendentes').textContent = obrigacoesPendentes;
        document.getElementById('obrigacoesAndamento').textContent = obrigacoesAndamento;
        document.getElementById('obrigacoesConcluidas').textContent = obrigacoesConcluidas;
        document.getElementById('obrigacoesVencidas').textContent = obrigacoesVencidas;
    }
}

        function ativarExclusaoLote() {
            modoExclusaoLote = true;
            obrigacoesSelecionadas = [];
            renderizarObrigacoes();
            mostrarNotificacao('Selecione as obrigações que deseja excluir e clique em "Excluir Selecionadas".', 'info');
        }

        function renderizarObrigacoes() {
            const container = document.getElementById('obrigacoesContainer');
            if (!container) return;
            
            container.innerHTML = '';

            if (obrigacoes.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-clipboard-list" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>Nenhuma obrigação cadastrada. Adicione sua primeira obrigação!</p>
                    </div>
                `;
                return;
            }

            obrigacoes.forEach(obrigacao => {
                const card = criarCardObrigacao(obrigacao);
                if (modoExclusaoLote) {
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'lote-checkbox';
                    checkbox.style.marginRight = '8px';
                    checkbox.checked = obrigacoesSelecionadas.includes(obrigacao.id);
                    checkbox.onclick = () => {
                        if (checkbox.checked) {
                            obrigacoesSelecionadas.push(obrigacao.id);
                        } else {
                            obrigacoesSelecionadas = obrigacoesSelecionadas.filter(id => id !== obrigacao.id);
                        }
                    };
                    card.querySelector('.card-header').prepend(checkbox);
                }
                container.appendChild(card);
            });

            if (modoExclusaoLote) {
                const btnExcluir = document.createElement('button');
                btnExcluir.className = 'btn';
                btnExcluir.textContent = 'Excluir Selecionadas';
                btnExcluir.onclick = excluirObrigacoesLote;
                container.appendChild(btnExcluir);

                const btnCancelar = document.createElement('button');
                btnCancelar.className = 'btn btn-outline';
                btnCancelar.textContent = 'Cancelar Seleção';
                btnCancelar.onclick = () => {
                    modoExclusaoLote = false;
                    obrigacoesSelecionadas = [];
                    renderizarObrigacoes();
                };
                container.appendChild(btnCancelar);
            }
        }

        function criarCardObrigacao(obrigacao) {
            const card = document.createElement('div');
            card.className = `obrigacao-card prioridade-${obrigacao.prioridade}`;
            card.dataset.id = obrigacao.id;
            card.dataset.criacao = obrigacao.dataCriacao;
            card.dataset.prioridade = obrigacao.prioridade;
            if (obrigacao.dataVencimento) card.dataset.vencimento = obrigacao.dataVencimento;

            card.innerHTML = `
                <div class="card-header">
                    <div>
                        <div class="card-title">${obrigacao.titulo}</div>
                        <div class="card-subtitle">${formatarDataPadrao(obrigacao.dataCriacao)}</div>
                    </div>
                    <span class="card-badge">${obrigacao.categoria}</span>
                </div>
                <div class="card-content">
                    <div class="card-preview">${obrigacao.descricao || 'Sem descrição'}</div>
                    <div class="card-tags">
                        <span class="card-tag prioridade-${obrigacao.prioridade}">${obrigacao.prioridade}</span>
                        <span class="card-tag status-${obrigacao.status}">${obrigacao.status}</span>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="card-actions">
                        <button class="card-btn btn-foco" title="Modo Foco">
                            <i class="fas fa-crosshairs"></i>
                        </button>
                        <button class="card-btn btn-visualizar" title="Visualizar">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="card-btn btn-editar" title="Editar">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="card-btn btn-excluir" title="Excluir">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;

            card.querySelector('.btn-foco').addEventListener('click', () => entrarModoFoco(obrigacao.id));
            card.querySelector('.btn-visualizar').addEventListener('click', () => visualizarObrigacao(obrigacao.id));
            card.querySelector('.btn-editar').addEventListener('click', () => editarObrigacao(obrigacao.id));
            card.querySelector('.btn-excluir').addEventListener('click', () => excluirObrigacao(obrigacao.id));

            return card;
        }

                function excluirObrigacoesLote() {
            if (obrigacoesSelecionadas.length === 0) {
                mostrarNotificacao('Nenhuma obrigação selecionada!', 'error');
                return;
            }
            if (confirm(`Excluir ${obrigacoesSelecionadas.length} obrigações?`)) {
                const obrigacoesParaExcluir = obrigacoes.filter(o => obrigacoesSelecionadas.includes(o.id));
                obrigacoesExcluidas.push(...obrigacoesParaExcluir);
                obrigacoes = obrigacoes.filter(o => !obrigacoesSelecionadas.includes(o.id));
                salvarObrigacoes();
                localStorage.setItem('obrigacoesExcluidas', JSON.stringify(obrigacoesExcluidas));
                renderizarObrigacoes();
                atualizarDashboard();
                atualizarEstatisticas();
                modoExclusaoLote = false;
                obrigacoesSelecionadas = [];
                mostrarNotificacao('Obrigações excluídas!', 'success');
            }
        }

        function excluirObrigacao(id) {
            if (confirm('Tem certeza que deseja excluir esta obrigação?')) {
                const obrigacaoIndex = obrigacoes.findIndex(o => o.id === id);
                if (obrigacaoIndex !== -1) {
                    const obrigacaoExcluida = obrigacoes[obrigacaoIndex];
                    obrigacoesExcluidas.push(obrigacaoExcluida);
                    obrigacoes.splice(obrigacaoIndex, 1);
                    salvarObrigacoes();
                    localStorage.setItem('obrigacoesExcluidas', JSON.stringify(obrigacoesExcluidas));
                    renderizarObrigacoes();
                    atualizarDashboard();
                    atualizarEstatisticas();
                    
                    if (editandoId === id) {
                        cancelarEdicao();
                    }
                    
                    if (currentObrigacaoId === id) {
                        fecharModal();
                    }
                    
                    mostrarNotificacao('Obrigação excluída com sucesso!', 'success');
                }
            }
        }


        function mostrarRecuperacaoObrigacoes() {
            const container = document.getElementById('obrigacoesContainer');
            container.innerHTML = '<h3>Obrigações Excluídas</h3>';
            
            if (obrigacoesExcluidas.length === 0) {
                container.innerHTML += `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-trash-restore" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>Nenhuma obrigação excluída para recuperar.</p>
                    </div>
                `;
                return;
            }
            
            obrigacoesExcluidas.forEach(obrigacao => {
                const card = criarCardObrigacao(obrigacao);
                const btnRecuperar = document.createElement('button');
                btnRecuperar.className = 'btn';
                btnRecuperar.textContent = 'Recuperar';
                btnRecuperar.onclick = () => recuperarObrigacao(obrigacao.id);
                card.querySelector('.card-actions').innerHTML = '';
                card.querySelector('.card-actions').appendChild(btnRecuperar);
                container.appendChild(card);
            });

            const btnVoltar = document.createElement('button');
            btnVoltar.className = 'btn btn-outline';
            btnVoltar.textContent = 'Voltar para Obrigações';
            btnVoltar.onclick = () => {
                modoExclusaoLote = false;
                renderizarObrigacoes();
            };
            container.appendChild(btnVoltar);
        }

        function recuperarObrigacao(id) {
            const obrigacao = obrigacoesExcluidas.find(o => o.id === id);
            if (obrigacao) {
                obrigacoes.push(obrigacao);
                obrigacoesExcluidas = obrigacoesExcluidas.filter(o => o.id !== id);
                salvarObrigacoes();
                localStorage.setItem('obrigacoesExcluidas', JSON.stringify(obrigacoesExcluidas));
                renderizarObrigacoes();
                atualizarDashboard();
                atualizarEstatisticas();
                mostrarNotificacao('Obrigação recuperada!', 'success');
            }
        }
        
    function visualizarObrigacao(id) {
        const obrigacao = obrigacoes.find(o => o.id === id);
        if (!obrigacao) return;

        currentObrigacaoId = id;
        document.getElementById('modalTitulo').textContent = obrigacao.titulo;

        const statusBadge = obrigacao.status === 'concluido' ?
            '<span class="status-badge status-concluido">Concluído</span>' :
            obrigacao.status === 'em-andamento' ?
            '<span class="status-badge status-andamento">Em Andamento</span>' :
            '<span class="status-badge status-pendente">Pendente</span>';

        document.getElementById('modalCorpo').innerHTML = `
            <div class="modal-section">
                <h3><i class="fas fa-user"></i> Nomes</h3>
                <p>${obrigacao.nomeAlternativo || 'Nenhum nome alternativo cadastrado.'}</p>
            </div>
            <div class="modal-section">
                <h3><i class="fas fa-info-circle"></i> Informações</h3>
                <p><strong>Categoria:</strong> ${obrigacao.categoria || 'Não definida'}</p>
                <p><strong>Prioridade:</strong> ${obrigacao.prioridade}</p>
                <p><strong>Status:</strong> ${statusBadge}</p>
                <p><strong>Recorrência:</strong> ${obrigacao.recorrencia !== 'nenhuma' ? obrigacao.recorrencia : 'Nenhuma'}</p>
                <p><strong>Criado em:</strong> ${obrigacao.dataCriacao}</p>
                <p><strong>Atualizado em:</strong> ${obrigacao.dataAtualizacao || obrigacao.dataCriacao}</p>
            </div>
            <div class="modal-section">
                <h3><i class="fas fa-calendar"></i> Datas</h3>
                <p>${obrigacao.dataParaFazer ? 'Data para Fazer: ' + obrigacao.dataParaFazer : ''}</p>
                <p>${obrigacao.dataLembrete ? 'Data para Lembrete: ' + obrigacao.dataLembrete : ''}</p>
                <p>${obrigacao.dataVencimento ? 'Data de Vencimento: ' + obrigacao.dataVencimento : 'Nenhuma data definida'}</p>
            </div>
            <div class="modal-section">
                <h3><i class="fas fa-calendar-alt"></i> Meses de Atividade</h3>
                <p>${obrigacao.mesesAtivos && obrigacao.mesesAtivos.length > 0 ? obrigacao.mesesAtivos.join(', ') : 'Nenhum mês específico definido'}</p>
            </div>
            <div class="modal-section">
                <h3><i class="fas fa-list-ol"></i> Passo a Passo</h3>
                <ol>
                    ${(obrigacao.passos || []).map((passo, idx) => `<li>${passo}</li>`).join('') || '<li>Nenhum passo cadastrado.</li>'}
                </ol>
            </div>
            <div class="modal-section">
                <h3><i class="fas fa-link"></i> Links Úteis</h3>
                <ul>
                    ${(obrigacao.links || []).map(link => `<li><a href="${link.url}" target="_blank">${link.titulo}</a></li>`).join('') || '<li>Nenhum link cadastrado.</li>'}
                </ul>
            </div>
            <div class="modal-section">
                <h3><i class="fas fa-image"></i> Imagens</h3>
                <div class="image-gallery">
                    ${(obrigacao.imagens || []).map(img => `<img src="${img}" class="gallery-image" alt="Imagem da obrigação">`).join('') || '<p>Nenhuma imagem cadastrada.</p>'}
                </div>
            </div>
            <div class="modal-section">
                <h3><i class="fas fa-history"></i> Histórico de Alterações</h3>
                <div>
                    ${(obrigacao.historico || []).map(registro => `<div><strong>${registro.data}</strong> - ${registro.acao}: ${registro.detalhes}</div>`).join('') || '<div>Nenhum histórico de alterações.</div>'}
                </div>
            </div>
        `;

        document.getElementById('modalFooter').innerHTML = `
            <button class="btn btn-outline" onclick="fecharModal()">Fechar</button>
            <button class="btn" id="btnEditarModal" onclick="habilitarEdicaoModal(${id})">Editar</button>
            <button class="btn" id="btnConcluirModal" style="background: var(--success);" onclick="concluirObrigacao(${id})">Marcar como Concluída</button>
        `;

        if (obrigacao.status === 'concluido') {
            document.getElementById('btnConcluirModal').style.display = 'none';
        } else {
            document.getElementById('btnConcluirModal').style.display = 'inline-block';
        }

        document.getElementById('obrigacaoModal').style.display = 'flex';
    }

function habilitarEdicaoModal(id) {
    const obrigacao = obrigacoes.find(o => o.id === id);
    if (!obrigacao) return;

    document.getElementById('modalTitulo').textContent = obrigacao.titulo;

    document.getElementById('modalCorpo').innerHTML = `
        <div class="modal-section">
            <h3><i class="fas fa-user"></i> Nomes</h3>
            <input type="text" id="editNomeAlternativo" value="${obrigacao.nomeAlternativo || ''}" placeholder="Nome alternativo">
        </div>
        <div class="modal-section">
            <h3><i class="fas fa-align-left"></i> Descrição</h3>
            <textarea id="editDescricao">${obrigacao.descricao || ''}</textarea>
        </div>
        <div class="modal-section">
            <h3><i class="fas fa-info-circle"></i> Informações</h3>
            <p><strong>Status:</strong>
                <select id="editStatus">
                    <option value="pendente" ${obrigacao.status === 'pendente' ? 'selected' : ''}>Pendente</option>
                    <option value="em-andamento" ${obrigacao.status === 'em-andamento' ? 'selected' : ''}>Em andamento</option>
                    <option value="concluido" ${obrigacao.status === 'concluido' ? 'selected' : ''}>Concluído</option>
                </select>
            </p>
            <p><strong>Categoria:</strong>
                <select id="editCategoria">
                    <option value="trabalho" ${obrigacao.categoria === 'trabalho' ? 'selected' : ''}>Trabalho</option>
                    <option value="pessoal" ${obrigacao.categoria === 'pessoal' ? 'selected' : ''}>Pessoal</option>
                    <option value="estudos" ${obrigacao.categoria === 'estudos' ? 'selected' : ''}>Estudos</option>
                    <option value="saude" ${obrigacao.categoria === 'saude' ? 'selected' : ''}>Saúde</option>
                    <option value="financeiro" ${obrigacao.categoria === 'financeiro' ? 'selected' : ''}>Financeiro</option>
                    <option value="outros" ${obrigacao.categoria === 'outros' ? 'selected' : ''}>Outros</option>
                </select>
            </p>
            <p><strong>Prioridade:</strong>
                <select id="editPrioridade">
                    <option value="urgente" ${obrigacao.prioridade === 'urgente' ? 'selected' : ''}>Urgente</option>
                    <option value="alta" ${obrigacao.prioridade === 'alta' ? 'selected' : ''}>Alta</option>
                    <option value="media" ${obrigacao.prioridade === 'media' ? 'selected' : ''}>Média</option>
                    <option value="baixa" ${obrigacao.prioridade === 'baixa' ? 'selected' : ''}>Baixa</option>
                </select>
            </p>
            <p><strong>Recorrência:</strong>
                <select id="editRecorrencia">
                    <option value="nenhuma" ${obrigacao.recorrencia === 'nenhuma' ? 'selected' : ''}>Nenhuma</option>
                    <option value="diaria" ${obrigacao.recorrencia === 'diaria' ? 'selected' : ''}>Diária</option>
                    <option value="semanal" ${obrigacao.recorrencia === 'semanal' ? 'selected' : ''}>Semanal</option>
                    <option value="quinzenal" ${obrigacao.recorrencia === 'quinzenal' ? 'selected' : ''}>Quinzenal</option>
                    <option value="mensal" ${obrigacao.recorrencia === 'mensal' ? 'selected' : ''}>Mensal</option>
                    <option value="anual" ${obrigacao.recorrencia === 'anual' ? 'selected' : ''}>Anual</option>
                </select>
            </p>
        </div>
        <div class="modal-section">
            <h3><i class="fas fa-calendar"></i> Datas</h3>
            <input type="date" id="editDataParaFazer" value="${obrigacao.dataParaFazer || ''}" placeholder="Data para Fazer">
            <input type="date" id="editDataLembrete" value="${obrigacao.dataLembrete || ''}" placeholder="Data para Lembrete">
            <input type="date" id="editDataVencimento" value="${obrigacao.dataVencimento || ''}" placeholder="Data de Vencimento">
        </div>
        <div class="modal-section">
            <h3><i class="fas fa-calendar-alt"></i> Meses de Atividade</h3>
            <input type="text" id="editMesesAtivos" value="${(obrigacao.mesesAtivos || []).join(', ')}" placeholder="Ex: Janeiro, Fevereiro">
        </div>
        <div class="modal-section">
            <h3><i class="fas fa-list-ol"></i> Passo a Passo</h3>
            <textarea id="editPassos" placeholder="Passo a passo">${(obrigacao.passos || []).join('\n')}</textarea>
        </div>
        <div class="modal-section">
            <h3><i class="fas fa-link"></i> Links Úteis</h3>
            <textarea id="editLinks" placeholder="Título|URL por linha">${(obrigacao.links || []).map(l => `${l.titulo}|${l.url}`).join('\n')}</textarea>
        </div>
        <div class="modal-section">
            <h3><i class="fas fa-image"></i> Imagens</h3>
            <textarea id="editImagens" placeholder="URLs das imagens, uma por linha">${(obrigacao.imagens || []).join('\n')}</textarea>
        </div>
        <div class="modal-section">
            <h3><i class="fas fa-history"></i> Histórico de Alterações</h3>
            <div>
                <div><strong>Data de Criação:</strong> ${obrigacao.dataCriacao}</div>
                <div><strong>Data de Atualização:</strong> ${obrigacao.dataAtualizacao || obrigacao.dataCriacao}</div>
                ${(obrigacao.historico || []).map(registro => `<div><strong>${registro.data}</strong> - ${registro.acao}: ${registro.detalhes}</div>`).join('') || '<div>Nenhum histórico de alterações.</div>'}
            </div>
        </div>
    `;

    document.getElementById('modalFooter').innerHTML = `
        <button class="btn btn-outline" onclick="visualizarObrigacao(${id})">Cancelar</button>
        <button class="btn" onclick="salvarEdicaoModal(${id})">Salvar</button>
        <button class="btn" style="background: var(--success);" onclick="concluirObrigacao(${id})">Concluir</button>
    `;
}

    function salvarEdicaoModal(id) {
        const obrigacao = obrigacoes.find(o => o.id === id);
        if (!obrigacao) return;

        obrigacao.status = document.getElementById('editStatus').value;
        obrigacao.categoria = document.getElementById('editCategoria').value;
        obrigacao.prioridade = document.getElementById('editPrioridade').value;
        obrigacao.descricao = document.getElementById('editDescricao').value;

        salvarObrigacoes();
        renderizarObrigacoes();
        atualizarDashboard();
        atualizarEstatisticas();

        visualizarObrigacao(id);
    }

    function concluirObrigacao(id) {
        const obrigacao = obrigacoes.find(o => o.id === id);
        if (obrigacao) {
            obrigacao.status = 'concluido';
            salvarObrigacoes();
            renderizarObrigacoes();
            atualizarDashboard();
            atualizarEstatisticas();
            verificarMetasAutomaticamente();
            mostrarNotificacao('Obrigação concluída com sucesso!', 'success');
            fecharModal();
        }
    }

function excluirObrigacao(id) {
    if (confirm('Tem certeza que deseja excluir esta obrigação?')) {
        const obrigacaoIndex = obrigacoes.findIndex(o => o.id === id);
        if (obrigacaoIndex !== -1) {
            obrigacoes.splice(obrigacaoIndex, 1);
            salvarObrigacoes();
            renderizarObrigacoes();
            atualizarDashboard();
            atualizarEstatisticas();
            
            if (editandoId === id) {
                cancelarEdicao();
            }
            
            if (currentObrigacaoId === id) {
                fecharModal();
            }
            
            mostrarNotificacao('Obrigação excluída com sucesso!', 'success');
        }
    }
}

function fecharModal() {
    document.getElementById('obrigacaoModal').style.display = 'none';
    currentObrigacaoId = null;
}


function aplicarFiltros() {
    const searchTerm = document.getElementById('search-input').value.toLowerCase();
    const categoriaFiltro = document.getElementById('filter-categoria').value;
    const prioridadeFiltro = document.getElementById('filter-prioridade').value;
    const statusFiltro = document.getElementById('filter-status').value;
    
    const cards = document.querySelectorAll('.obrigacao-card');
    
    cards.forEach(card => {
        const titulo = card.querySelector('.card-title').textContent.toLowerCase();
        const categoria = card.querySelector('.card-badge').textContent.toLowerCase();
        const prioridade = card.className.includes('prioridade-') ? 
            card.className.match(/prioridade-(\w+)/)[1] : '';
        const statusElement = card.querySelector('.card-tag.status-pendente, .card-tag.status-andamento, .card-tag.status-concluido');
        const status = statusElement ? statusElement.textContent.toLowerCase() : '';
        
        const matchesSearch = titulo.includes(searchTerm) || (obrigacoes.find(o => o.id === parseInt(card.dataset.id))?.descricao?.toLowerCase().includes(searchTerm) || false);
        const matchesCategoria = !categoriaFiltro || categoria === categoriaFiltro;
        const matchesPrioridade = !prioridadeFiltro || prioridade === prioridadeFiltro;
        const matchesStatus = !statusFiltro || status === statusFiltro;
        
        if (matchesSearch && matchesCategoria && matchesPrioridade && matchesStatus) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
}


function inicializarGraficos() {
    if (!document.getElementById('categoryChart')) return;
    
    const dadosEstatisticas = calcularEstatisticas();
    
    if (document.getElementById('totalTasks')) {
        document.getElementById('totalTasks').textContent = dadosEstatisticas.total;
        document.getElementById('completedTasks').textContent = dadosEstatisticas.concluidas;
        document.getElementById('pendingTasks').textContent = dadosEstatisticas.pendentes;
        document.getElementById('completionRate').textContent = dadosEstatisticas.taxaConclusao + '%';
        document.getElementById('completionBar').style.width = dadosEstatisticas.taxaConclusao + '%';
        document.getElementById('pendingUrgent').textContent = dadosEstatisticas.urgentesPendentes;
        document.getElementById('productivityScore').textContent = dadosEstatisticas.pontuacaoProdutividade;
        document.getElementById('productivityBar').style.width = dadosEstatisticas.pontuacaoProdutividade + '%';
        document.getElementById('productivityLevel').textContent = dadosEstatisticas.nivelProdutividade;
    }
    
    criarGraficoCategorias(dadosEstatisticas.categorias);
    criarGraficoProgresso(dadosEstatisticas.progressoSemanal);
    criarGraficoPrioridades(dadosEstatisticas.prioridades);
    criarGraficoConclusao(dadosEstatisticas.historicoConclusao);
}

function calcularEstatisticas() {
    const hoje = new Date();
    const inicioMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
    
    const obrigacoesMes = obrigacoes.filter(obrigacao => {
        const dataObrigacao = new Date(obrigacao.dataCriacao);
        return dataObrigacao >= inicioMes;
    });
    
    const total = obrigacoesMes.length;
    
    const concluidas = obrigacoesMes.filter(o => o.status === 'concluido').length;
    const pendentes = obrigacoesMes.filter(o => o.status === 'pendente').length;
    const emAndamento = obrigacoesMes.filter(o => o.status === 'andamento').length;
    
    const taxaConclusao = total > 0 ? Math.round((concluidas / total) * 100) : 0;
    
    const categorias = {};
    obrigacoesMes.forEach(obrigacao => {
        categorias[obrigacao.categoria] = (categorias[obrigacao.categoria] || 0) + 1;
    });
    
    const prioridades = {
        urgente: obrigacoesMes.filter(o => o.prioridade === 'urgente').length,
        alta: obrigacoesMes.filter(o => o.prioridade === 'alta').length,
        media: obrigacoesMes.filter(o => o.prioridade === 'media').length,
        baixa: obrigacoesMes.filter(o => o.prioridade === 'baixa').length
    };
    
    const urgentesPendentes = obrigacoesMes.filter(o => 
        o.prioridade === 'urgente' && o.status === 'pendente'
    ).length;
    
    const pontuacaoProdutividade = Math.min(100, Math.round(
        (concluidas * 2) + (obrigacoesMes.filter(o => o.prioridade === 'alta' || o.prioridade === 'urgente').length)
    ));
    
    let nivelProdutividade = 'Iniciante';
    if (pontuacaoProdutividade >= 80) nivelProdutividade = 'Excelente';
    else if (pontuacaoProdutividade >= 60) nivelProdutividade = 'Bom';
    else if (pontuacaoProdutividade >= 40) nivelProdutividade = 'Regular';
    
    const progressoSemanal = [];
    for (let i = 6; i >= 0; i--) {
        const data = new Date();
        data.setDate(data.getDate() - i);
        const dataFormatada = data.toISOString().split('T')[0];
        
        const obrigacoesDia = obrigacoesMes.filter(o => 
            o.dataCriacao === dataFormatada
        ).length;
        
        const concluidasDia = obrigacoesMes.filter(o => 
            o.dataCriacao === dataFormatada && o.status === 'concluido'
        ).length;
        
        progressoSemanal.push({
            dia: data.toLocaleDateString('pt-BR', { weekday: 'short' }),
            total: obrigacoesDia,
            concluidas: concluidasDia
        });
    }
    
    const historicoConclusao = [];
    for (let i = 3; i >= 0; i--) {
        const mes = new Date(hoje.getFullYear(), hoje.getMonth() - i, 1);
        const mesFormatado = mes.toLocaleDateString('pt-BR', { month: 'short' });
        
        const obrigacoesMesHistorico = obrigacoes.filter(o => {
            const dataObrigacao = new Date(o.dataCriacao);
            return dataObrigacao.getMonth() === mes.getMonth() && 
                   dataObrigacao.getFullYear() === mes.getFullYear();
        });
        
        const totalMes = obrigacoesMesHistorico.length;
        const concluidasMes = obrigacoesMesHistorico.filter(o => o.status === 'concluido').length;
        const taxaMes = totalMes > 0 ? Math.round((concluidasMes / totalMes) * 100) : 0;
        
        historicoConclusao.push({
            mes: mesFormatado,
            taxa: taxaMes
        });
    }
    
    return {
        total,
        concluidas,
        pendentes,
        taxaConclusao,
        categorias,
        prioridades,
        urgentesPendentes,
        pontuacaoProdutividade,
        nivelProdutividade,
        progressoSemanal,
        historicoConclusao
    };
}

function criarGraficoCategorias(dadosCategorias) {
    const ctx = document.getElementById('categoryChart');
    if (!ctx) return;
    const isDark = document.body.classList.contains('dark-mode');
    const labels = Object.keys(dadosCategorias);
    const data = Object.values(dadosCategorias);

    if (chartCategorias) chartCategorias.destroy();

    chartCategorias = new Chart(ctx.getContext('2d'), {
        type: 'doughnut',
        data: {
            labels: labels,
            datasets: [{
                data: data,
                backgroundColor: [
                    '#4361ee', '#3a0ca3', '#4cc9f0', '#f72585', '#7209b7',
                    '#b5179e', '#560bad', '#480ca8', '#3a0ca3', '#3f37c9'
                ],
                borderWidth: 2,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: isDark ? '#fff' : '#333'
                    }
                }
            }
        }
    });
}

function criarGraficoProgresso(dadosProgresso) {
    const ctx = document.getElementById('progressChart');
    if (!ctx) return;
    const isDark = document.body.classList.contains('dark-mode');

    if (chartProgresso) chartProgresso.destroy();

    chartProgresso = new Chart(ctx.getContext('2d'), {
        type: 'bar',
        data: {
            labels: dadosProgresso.map(d => d.dia),
            datasets: [
                {
                    label: 'Concluídas',
                    data: dadosProgresso.map(d => d.concluidas),
                    backgroundColor: '#4cc9f0',
                    borderRadius: 6
                },
                {
                    label: 'Total',
                    data: dadosProgresso.map(d => d.total),
                    backgroundColor: '#4361ee',
                    borderRadius: 6
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        color: isDark ? '#fff' : '#333'
                    }
                }
            },
            scales: {
                x: {
                    ticks: {
                        color: isDark ? '#fff' : '#333'
                    }
                },
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1,
                        color: isDark ? '#fff' : '#333'
                    }
                }
            }
        }
    });
}

function criarGraficoPrioridades(dadosPrioridades) {
    const ctx = document.getElementById('priorityChart');
    if (!ctx) return;
    const isDark = document.body.classList.contains('dark-mode');

    if (chartPrioridades) chartPrioridades.destroy();

    chartPrioridades = new Chart(ctx.getContext('2d'), {
        type: 'polarArea',
        data: {
            labels: ['Urgente', 'Alta', 'Média', 'Baixa'],
            datasets: [{
                data: [
                    dadosPrioridades.urgente,
                    dadosPrioridades.alta,
                    dadosPrioridades.media,
                    dadosPrioridades.baixa
                ],
                backgroundColor: [
                    '#e74c3c', '#e67e22', '#f1c40f', '#2ecc71'
                ],
                borderWidth: 2,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: isDark ? '#fff' : '#333'
                    }
                }
            },
            scales: {
                r: {
                    angleLines: {
                        color: isDark ? '#fff' : '#333'
                    },
                    grid: {
                        color: isDark ? '#fff' : '#333'
                    },
                    pointLabels: {
                        color: isDark ? '#fff' : '#333',
                        font: {
                            size: 14
                        }
                    },
                    ticks: {
                        display: false
                    }
                }
            }
        }
    });
}

function criarGraficoConclusao(dadosHistorico) {
    const ctx = document.getElementById('completionChart');
    if (!ctx) return;
    const isDark = document.body.classList.contains('dark-mode');

    if (chartConclusao) chartConclusao.destroy();

    chartConclusao = new Chart(ctx.getContext('2d'), {
        type: 'line',
        data: {
            labels: dadosHistorico.map(h => h.mes),
            datasets: [{
                label: 'Taxa de Conclusão (%)',
                data: dadosHistorico.map(h => h.taxa),
                borderColor: '#4361ee',
                backgroundColor: 'rgba(67, 97, 238, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        color: isDark ? '#fff' : '#333'
                    }
                }
            },
            scales: {
                x: {
                    ticks: {
                        color: isDark ? '#fff' : '#333'
                    }
                },
                y: {
                    min: 0,
                    max: 100,
                    ticks: {
                        callback: function(value) {
                            return value + '%';
                        },
                        color: isDark ? '#fff' : '#333'
                    }
                }
            }
        }
    });
}

function atualizarEstatisticas() {
    inicializarGraficos();
}


function abrirModalTemplate(templateId = null) {
    templateEditando = templateId;
    const modal = document.getElementById('templateModal');
    const titulo = document.getElementById('templateModalTitle');
    const salvarBtn = document.getElementById('templateSalvarBtn');
    
    if (templateId) {
        titulo.textContent = 'Editar Template';
        salvarBtn.textContent = 'Atualizar Template';
        preencherFormTemplate(templateId);
    } else {
        titulo.textContent = 'Novo Template';
        salvarBtn.textContent = 'Salvar Template';
        limparFormTemplate();
    }
    
    modal.style.display = 'flex';

    const selectRecorrencia = document.getElementById('templateRecorrencia');
    if (selectRecorrencia) {
        selectRecorrencia.removeEventListener('change', toggleDiasContainer);
        selectRecorrencia.addEventListener('change', toggleDiasContainer);
        toggleDiasContainer();
    }
}

function formatarDataPadrao(dataIso) {
    if (!dataIso) return '';
    const [ano, mes, dia] = dataIso.split('-');
    return `${dia}/${mes}/${ano}`;
}

function fecharModalTemplate() {
    document.getElementById('templateModal').style.display = 'none';
    templateEditando = null;
}

function preencherFormTemplate(templateId) {
    const template = templates.find(t => t.id === templateId);
    if (!template) return;
    
    document.getElementById('templateNome').value = template.nome;
    document.getElementById('templateDescricao').value = template.descricao;
    document.getElementById('templateCategoria').value = template.categoria;
    document.getElementById('templatePrioridade').value = template.prioridade;
    document.getElementById('templateRecorrencia').value = template.recorrencia;
    
    document.querySelectorAll('input[name="templateDias"]').forEach(cb => {
        cb.checked = false;
    });
    
    if (template.diasRecorrencia) {
        template.diasRecorrencia.forEach(dia => {
            const checkbox = document.querySelector(`input[name="templateDias"][value="${dia}"]`);
            if (checkbox) checkbox.checked = true;
        });
    }
    
    toggleDiasContainer();
}

function limparFormTemplate() {
    document.getElementById('templateNome').value = '';
    document.getElementById('templateDescricao').value = '';
    document.getElementById('templateCategoria').value = 'trabalho';
    document.getElementById('templatePrioridade').value = 'media';
    document.getElementById('templateRecorrencia').value = 'nenhuma';
    
    document.querySelectorAll('input[name="templateDias"]').forEach(cb => {
        cb.checked = false;
    });
    
    toggleDiasContainer();
}

function toggleDiasContainer() {
    const recorrencia = document.getElementById('templateRecorrencia').value;
    const diasContainer = document.getElementById('templateDiasContainer');
    const semanasContainer = document.getElementById('templateSemanasContainer');
    const mesesContainer = document.getElementById('templateMesesContainer');
    const anosContainer = document.getElementById('templateAnosContainer');

    diasContainer.style.display = recorrencia === 'semanal' ? 'block' : 'none';
    semanasContainer.style.display = recorrencia === 'semanal' ? 'block' : 'none';
    
    mesesContainer.style.display = recorrencia === 'mensal' ? 'block' : 'none';
    
    anosContainer.style.display = recorrencia === 'anual' ? 'block' : 'none';
}

function salvarTemplate() {
    const nome = document.getElementById('templateNome').value.trim();
    const descricao = document.getElementById('templateDescricao').value.trim();
    const categoria = document.getElementById('templateCategoria').value;
    const prioridade = document.getElementById('templatePrioridade').value;
    const recorrencia = document.getElementById('templateRecorrencia').value;

    if (!nome) {
        mostrarNotificacao('Por favor, informe um nome para o template!', 'error');
        return;
    }

    let diasRecorrencia = [];
    if (recorrencia === 'semanal') {
        document.querySelectorAll('input[name="templateDias"]:checked').forEach(cb => {
            diasRecorrencia.push(parseInt(cb.value));
        });
        if (diasRecorrencia.length === 0) {
            mostrarNotificacao('Selecione pelo menos um dia da semana!', 'error');
            return;
        }
    }

    let semanasRecorrencia = 1;
    if (recorrencia === 'semanal') {
        semanasRecorrencia = parseInt(document.getElementById('templateSemanas').value) || 1;
        if (semanasRecorrencia < 1 || semanasRecorrencia > 52) {
            mostrarNotificacao('A quantidade de semanas deve ser entre 1 e 52!', 'error');
            return;
        }
    }

    let mesesRecorrencia = [];
    if (recorrencia === 'mensal') {
        const checkboxes = document.querySelectorAll('#templateMesesContainer input[type="checkbox"]:checked');
        checkboxes.forEach(cb => {
            mesesRecorrencia.push(parseInt(cb.value));
        });
        if (mesesRecorrencia.length === 0) {
            mostrarNotificacao('Selecione pelo menos um mês!', 'error');
            return;
        }
    }

    let anosRecorrencia = [];
    if (recorrencia === 'anual') {
        const anosStr = document.getElementById('templateAnos').value.trim();
        if (anosStr) {
            anosRecorrencia = anosStr.split(',').map(a => parseInt(a.trim())).filter(a => !isNaN(a) && a >= new Date().getFullYear());
        }
        if (anosRecorrencia.length === 0) {
            mostrarNotificacao('Informe pelo menos um ano válido (a partir do atual)!', 'error');
            return;
        }
    }

    const templateData = {
        id: templateEditando || Date.now(),
        nome,
        descricao,
        categoria,
        prioridade,
        recorrencia,
        diasRecorrencia: recorrencia === 'semanal' ? diasRecorrencia : [],
        semanasRecorrencia: recorrencia === 'semanal' ? semanasRecorrencia : 1,
        mesesRecorrencia: recorrencia === 'mensal' ? mesesRecorrencia : [],
        anosRecorrencia: recorrencia === 'anual' ? anosRecorrencia : [],
        dataCriacao: new Date().toISOString(),
        dataAtualizacao: new Date().toISOString()
    };

    if (templateEditando) {
        const index = templates.findIndex(t => t.id === templateEditando);
        if (index !== -1) {
            templateData.dataCriacao = templates[index].dataCriacao;
            templates[index] = templateData;
            mostrarNotificacao('Template atualizado com sucesso!', 'success');
        }
    } else {
        templates.push(templateData);
        mostrarNotificacao('Template criado com sucesso!', 'success');
    }

    salvarTemplates();
    renderizarTemplates();
    fecharModalTemplate();
}

function salvarTemplates() {
    localStorage.setItem('templates', JSON.stringify(templates));
    atualizarInfoBackup();
}

function renderizarTemplates() {
    const container = document.getElementById('templates-container');
    if (!container) return;
    
    container.innerHTML = '';
    
    if (templates.length === 0) {
        container.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #666;">
                <i class="fas fa-clone" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                <p>Nenhum template salvo. Crie seu primeiro template!</p>
            </div>
        `;
        return;
    }
    
    templates.forEach(template => {
        const templateElement = document.createElement('div');
        templateElement.className = 'template-card';
        templateElement.innerHTML = `
            <h4>${template.nome}</h4>
            <div class="template-meta">
                <span class="template-badge">${template.categoria}</span>
                <span class="template-badge">${template.prioridade}</span>
                <span class="template-badge">${template.recorrencia}</span>
            </div>
            <p style="font-size: 12px; color: #666; margin-bottom: 10px;">${template.descricao || 'Sem descrição'}</p>
            <p style="font-size: 12px; color: #666;">${formatarDataPadrao(template.dataCriacao)}</p>
            <div class="template-actions">
                <button class="template-btn" onclick="usarTemplate(${template.id})" title="Usar Template">
                    <i class="fas fa-plus"></i>
                </button>
                <button class="template-btn" onclick="abrirModalTemplate(${template.id})" title="Editar">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="template-btn" onclick="limparTemplateFormulario()" title="Limpar Formulário">
                    <i class="fas fa-eraser"></i>
                </button>
                <button class="template-btn" onclick="excluirTemplate(${template.id})" title="Excluir">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        `;
        container.appendChild(templateElement);
    });
}

function usarTemplate(templateId) {
    const template = templates.find(t => t.id === templateId);
    if (!template) return;
    
    if (template.recorrencia !== 'nenhuma') {
        const confirmar = confirm(`Este template possui recorrência "${template.recorrencia}". Deseja criar as obrigações automaticamente? Clique em "Cancelar" para apenas preencher o formulário.`);
        
        if (confirmar) {
            criarObrigacoesRecorrentes(template);
        } else {
            preencherFormularioComTemplate(template);
            mostrarNotificacao('Template carregado no formulário! Ajuste se necessário e clique em Adicionar.', 'info');
        }
    } else {
        preencherFormularioComTemplate(template);
        mostrarNotificacao('Template carregado! Ajuste se necessário e clique em Adicionar.', 'info');
    }
}

function preencherFormularioComTemplate(template) {
    document.getElementById('tipoObrigacao').value = template.nome;
    document.getElementById('descricao').value = template.descricao;
    document.getElementById('categoria').value = template.categoria;
    document.getElementById('prioridade').value = template.prioridade;
    document.getElementById('recorrencia').value = template.recorrencia;
    
    if (editandoId) {
        cancelarEdicao();
    }
}

function criarObrigacoesRecorrentes(template) {
    let datas = [];
    const hoje = new Date();

    switch (template.recorrencia) {
        case 'diaria':
            for (let i = 0; i < 7; i++) {
                const data = new Date(hoje);
                data.setDate(hoje.getDate() + i);
                datas.push(new Date(data));
            }
            break;
            
        case 'semanal':
            for (let s = 0; s < (template.semanasRecorrencia || 1); s++) {
                for (let d = 0; d < 7; d++) {
                    const data = new Date(hoje);
                    data.setDate(hoje.getDate() + (s * 7) + d);
                    if (template.diasRecorrencia && template.diasRecorrencia.includes(data.getDay())) {
                        datas.push(new Date(data));
                    }
                }
            }
            break;
            
        case 'mensal':
            const anoAtual = hoje.getFullYear();
            if (template.mesesRecorrencia && template.mesesRecorrencia.length > 0) {
                template.mesesRecorrencia.forEach(mes => {
                    const data = new Date(anoAtual, mes - 1, 1);
                    if (data < hoje) {
                        data.setFullYear(anoAtual + 1);
                    }
                    datas.push(new Date(data));
                });
            } else {
                for (let m = 0; m < 12; m++) {
                    const data = new Date(anoAtual, hoje.getMonth() + m, 1);
                    datas.push(new Date(data));
                }
            }
            break;
            
        case 'anual':
            if (template.anosRecorrencia && template.anosRecorrencia.length > 0) {
                template.anosRecorrencia.forEach(ano => {
                    const data = new Date(ano, hoje.getMonth(), hoje.getDate());
                    if (data >= new Date(hoje.setHours(0,0,0,0))) {
                        datas.push(new Date(data));
                    }
                });
            } else {
                for (let a = 0; a < 5; a++) {
                    const data = new Date(hoje.getFullYear() + a, hoje.getMonth(), hoje.getDate());
                    datas.push(new Date(data));
                }
            }
            break;
            
        case 'quinzenal':
            for (let i = 0; i < 8; i++) {
                const data = new Date(hoje);
                data.setDate(hoje.getDate() + (i * 15));
                datas.push(new Date(data));
            }
            break;
    }

    datas = datas.filter((data, index, self) => 
        index === self.findIndex(d => 
            d.getTime() === data.getTime()
        )
    ).sort((a, b) => a - b);

    if (datas.length > 50) {
        const confirmar = confirm(`Este template criará ${datas.length} obrigações. Isso pode ser muitos. Deseja limitar para as próximas 30?`);
        if (confirmar) {
            datas = datas.slice(0, 30);
        }
    }

    if (datas.length === 0) {
        mostrarNotificacao('Nenhuma data válida encontrada para criar obrigações.', 'warning');
        return;
    }

    let obrigacoesCriadas = 0;
    datas.forEach(data => {
        const dataFormatada = data.toISOString().split('T')[0];
        const existe = obrigacoes.find(o => 
            o.titulo === template.nome && 
            o.dataCriacao === dataFormatada
        );
        
        if (!existe) {
            const novaObrigacao = {
                id: Date.now() + Math.random(),
                titulo: template.nome,
                descricao: template.descricao,
                categoria: template.categoria,
                prioridade: template.prioridade,
                status: 'pendente',
                dataCriacao: dataFormatada,
                dataVencimento: calcularDataVencimento(template.prioridade, data),
                recorrencia: template.recorrencia
            };
            obrigacoes.push(novaObrigacao);
            obrigacoesCriadas++;
        }
    });

    if (obrigacoesCriadas > 0) {
        salvarObrigacoes();
        renderizarObrigacoes();
        aplicarFiltros();
        atualizarDashboard();
        atualizarEstatisticas();
        mostrarNotificacao(`${obrigacoesCriadas} obrigações criadas a partir do template!`, 'success');
    } else {
        mostrarNotificacao('Todas as obrigações deste template já existem!', 'info');
    }
}

function calcularDatasRecorrencia(template) {
    const datas = [];
    const hoje = new Date();
    
    switch (template.recorrencia) {
        case 'diaria':
            for (let i = 0; i < 7; i++) {
                const data = new Date(hoje);
                data.setDate(hoje.getDate() + i);
                datas.push(data);
            }
            break;
            
        case 'semanal':
            for (let i = 0; i < 28; i++) {
                const data = new Date(hoje);
                data.setDate(hoje.getDate() + i);
                if (template.diasRecorrencia.includes(data.getDay())) {
                    datas.push(data);
                }
            }
            break;
            
        case 'mensal':
            for (let i = 0; i < 12; i++) {
                const data = new Date(hoje.getFullYear(), hoje.getMonth() + i, 1);
                datas.push(data);
            }
            break;
            
        case 'anual':
            for (let i = 0; i < 5; i++) {
                const data = new Date(hoje.getFullYear() + i, hoje.getMonth(), hoje.getDate());
                datas.push(data);
            }
            break;
    }
    
    return datas;
}

function calcularDataVencimento(prioridade, dataBase = new Date()) {
    const data = new Date(dataBase);
    let dias = 7;
    
    switch (prioridade) {
        case 'urgente': dias = 1; break;
        case 'alta': dias = 3; break;
        case 'media': dias = 7; break;
        case 'baixa': dias = 30; break;
    }
    
    data.setDate(data.getDate() + dias);
    return data.toISOString().split('T')[0];
}

function excluirTemplate(templateId) {
    if (confirm('Tem certeza que deseja excluir este template?')) {
        templates = templates.filter(t => t.id !== templateId);
        salvarTemplates();
        renderizarTemplates();
        mostrarNotificacao('Template excluído com sucesso!', 'success');
    }
}

function limparTemplateFormulario() {
    document.getElementById('tipoObrigacao').value = '';
    document.getElementById('descricao').value = '';
    document.getElementById('categoria').value = 'outros';
    document.getElementById('prioridade').value = 'media';
    document.getElementById('status').value = 'pendente';
    document.getElementById('recorrencia').value = 'nenhuma';
    document.getElementById('dataParaFazer').value = '';
    document.getElementById('dataLembrete').value = '';
    document.getElementById('dataVencimento').value = '';
    
    document.querySelectorAll('#mesesAtividade input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = false;
    });
    
    document.getElementById('passos').value = '';
    
    document.getElementById('linksList').innerHTML = '';
    
    if (editandoId) {
        cancelarEdicao();
    }
    
    mostrarNotificacao('Formulário limpo!', 'info');
}


function abrirModalMeta(metaId = null) {
    metaEditando = metaId;
    const modal = document.getElementById('metaModal');
    const titulo = document.getElementById('metaModalTitle');
    const salvarBtn = document.getElementById('metaSalvarBtn');
    
    if (metaId) {
        titulo.textContent = 'Editar Meta';
        salvarBtn.textContent = 'Atualizar Meta';
        preencherFormMeta(metaId);
    } else {
        titulo.textContent = 'Nova Meta';
        salvarBtn.textContent = 'Criar Meta';
        limparFormMeta();
    }
    
    modal.style.display = 'flex';
}

function fecharModalMeta() {
    document.getElementById('metaModal').style.display = 'none';
    metaEditando = null;
}

function selecionarTipoMeta(tipo) {
    tipoMetaSelecionado = tipo;
    
    document.querySelectorAll('.meta-tipo-opcao').forEach(opcao => {
        opcao.classList.remove('selecionada');
    });
    document.querySelector(`.meta-tipo-opcao[data-tipo="${tipo}"]`).classList.add('selecionada');
    
    document.getElementById('metaQuantidadeContainer').style.display = 
        tipo === 'quantidade' ? 'block' : 'none';
    document.getElementById('metaFrequenciaContainer').style.display = 
        tipo === 'frequencia' ? 'block' : 'none';
}

function preencherFormMeta(metaId) {
    const meta = metas.find(m => m.id === metaId);
    if (!meta) return;
    
    document.getElementById('metaTitulo').value = meta.titulo;
    document.getElementById('metaDescricao').value = meta.descricao;
    document.getElementById('metaDataLimite').value = meta.dataLimite;
    document.getElementById('metaCategoria').value = meta.categoria || '';
    document.getElementById('metaPrioridade').value = meta.prioridade || '';
    
    selecionarTipoMeta(meta.tipo);
    
    if (meta.tipo === 'quantidade') {
        document.getElementById('metaQuantidade').value = meta.quantidadeAlvo;
    } else if (meta.tipo === 'frequencia') {
        document.getElementById('metaFrequencia').value = meta.frequencia;
    }
}

function limparFormMeta() {
    document.getElementById('metaTitulo').value = '';
    document.getElementById('metaDescricao').value = '';
    document.getElementById('metaDataLimite').value = '';
    document.getElementById('metaCategoria').value = '';
    document.getElementById('metaPrioridade').value = '';
    document.getElementById('metaQuantidade').value = '5';
    document.getElementById('metaFrequencia').value = 'diaria';
    
    selecionarTipoMeta('quantidade');
}

function salvarMeta() {
    const titulo = document.getElementById('metaTitulo').value.trim();
    const descricao = document.getElementById('metaDescricao').value.trim();
    const dataLimite = document.getElementById('metaDataLimite').value;
    const categoria = document.getElementById('metaCategoria').value || null;
    const prioridade = document.getElementById('metaPrioridade').value || null;
    
    if (!titulo) {
        mostrarNotificacao('Por favor, informe um título para a meta!', 'error');
        return;
    }
    
    if (!dataLimite) {
        mostrarNotificacao('Por favor, defina uma data limite!', 'error');
        return;
    }
    
    const metaData = {
        id: metaEditando || Date.now(),
        titulo,
        descricao,
        tipo: tipoMetaSelecionado,
        dataLimite,
        categoria,
        prioridade,
        dataCriacao: new Date().toISOString(),
        status: 'ativa',
        progresso: 0,
        completada: false
    };
    
    if (tipoMetaSelecionado === 'quantidade') {
        metaData.quantidadeAlvo = parseInt(document.getElementById('metaQuantidade').value);
        metaData.quantidadeAtual = 0;
    } else if (tipoMetaSelecionado === 'frequencia') {
        metaData.frequencia = document.getElementById('metaFrequencia').value;
        metaData.diasConsecutivos = 0;
        metaData.ultimaConclusao = null;
    }
    
    if (metaEditando) {
        const index = metas.findIndex(m => m.id === metaEditando);
        if (index !== -1) {
            metaData.progresso = metas[index].progresso;
            metaData.completada = metas[index].completada;
            if (tipoMetaSelecionado === 'quantidade') {
                metaData.quantidadeAtual = metas[index].quantidadeAtual;
            } else if (tipoMetaSelecionado === 'frequencia') {
                metaData.diasConsecutivos = metas[index].diasConsecutivos;
                metaData.ultimaConclusao = metas[index].ultimaConclusao;
            }
            metas[index] = metaData;
            mostrarNotificacao('Meta atualizada com sucesso!', 'success');
        }
    } else {
        metas.push(metaData);
        mostrarNotificacao('Meta criada com sucesso!', 'success');
    }
    
    salvarMetas();
    renderizarMetas();
    atualizarEstatisticasMetas();
    fecharModalMeta();
}

function salvarMetas() {
    localStorage.setItem('metas', JSON.stringify(metas));
    atualizarInfoBackup();
}

function renderizarMetas() {
    const container = document.getElementById('metasContainer');
    if (!container) return;
    
    container.innerHTML = '';
    
    const metasOrdenadas = [...metas].sort((a, b) => {
        if (a.status !== b.status) {
            return a.status === 'ativa' ? -1 : 1;
        }
        return new Date(a.dataLimite) - new Date(b.dataLimite);
    });
    
    if (metasOrdenadas.length === 0) {
        container.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #666;">
                <i class="fas fa-bullseye" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                <p>Nenhuma meta definida. Crie sua primeira meta!</p>
                <button class="btn" onclick="abrirModalMeta()" style="margin-top: 15px;">
                    <i class="fas fa-plus"></i> Criar Primeira Meta
                </button>
            </div>
        `;
        return;
    }
    
    metasOrdenadas.forEach(meta => {
        const progresso = calcularProgressoMeta(meta);
        const estaCompleta = progresso >= 100;
        const estaExpirada = new Date(meta.dataLimite) < new Date() && !estaCompleta;
        
        const metaElement = document.createElement('div');
        metaElement.className = `meta-card ${estaCompleta ? 'completa' : ''} ${estaExpirada ? 'expirada' : ''}`;
        metaElement.innerHTML = `
            <div class="meta-info">
                <div>
                    <div class="meta-titulo">${meta.titulo}</div>
                    <span class="meta-status ${estaCompleta ? 'completa' : estaExpirada ? 'expirada' : 'ativa'}">
                        ${estaCompleta ? 'Concluída' : estaExpirada ? 'Expirada' : 'Ativa'}
                    </span>
                </div>
                <div style="font-size: 12px; color: #888;">
                    Até ${formatarDataSimples(new Date(meta.dataLimite))}
                </div>
            </div>
            
            <div class="meta-descricao">${meta.descricao}</div>
            
            <div class="meta-progresso">
                <div class="meta-progresso-bar" style="width: ${progresso}%"></div>
            </div>
            
            <div class="meta-detalhes">
                <span>${obterTextoProgresso(meta, progresso)}</span>
                <span>${progresso}% completo</span>
            </div>
            
            <div class="meta-acoes">
                ${!estaCompleta && !estaExpirada ? `
                    <button class="meta-btn primary" onclick="atualizarProgressoMeta(${meta.id})">
                        <i class="fas fa-plus"></i> Atualizar
                    </button>
                ` : ''}
                <button class="meta-btn secondary" onclick="abrirModalMeta(${meta.id})">
                    <i class="fas fa-edit"></i> Editar
                </button>
                <button class="meta-btn secondary" onclick="excluirMeta(${meta.id})">
                    <i class="fas fa-trash"></i> Excluir
                </button>
            </div>
        `;
        container.appendChild(metaElement);
    });
}

function calcularProgressoMeta(meta) {
    if (meta.completada) return 100;
    
    if (meta.tipo === 'quantidade') {
        return Math.min(100, Math.round((meta.quantidadeAtual / meta.quantidadeAlvo) * 100));
    } else if (meta.tipo === 'frequencia') {
        const hoje = new Date().toISOString().split('T')[0];
        const dataLimite = new Date(meta.dataLimite);
        const diasTotais = Math.ceil((dataLimite - new Date(meta.dataCriacao)) / (1000 * 60 * 60 * 24));
        const diasPassados = Math.ceil((new Date() - new Date(meta.dataCriacao)) / (1000 * 60 * 60 * 24));
        
        return Math.min(100, Math.round((diasPassados / diasTotais) * 100));
    }
    
    return 0;
}

function obterTextoProgresso(meta, progresso) {
    if (meta.tipo === 'quantidade') {
        return `${meta.quantidadeAtual || 0}/${meta.quantidadeAlvo} tarefas`;
    } else if (meta.tipo === 'frequencia') {
        return `${meta.diasConsecutivos || 0} dias consecutivos`;
    }
    return 'Progresso: ' + progresso + '%';
}

function atualizarProgressoMeta(metaId) {
    const meta = metas.find(m => m.id === metaId);
    if (!meta) return;
    
    if (meta.tipo === 'quantidade') {
        const novaQuantidade = parseInt(prompt(`Quantas tarefas completou? (Atual: ${meta.quantidadeAtual || 0}, Meta: ${meta.quantidadeAlvo})`, "1"));
        
        if (!isNaN(novaQuantidade) && novaQuantidade > 0) {
            meta.quantidadeAtual = (meta.quantidadeAtual || 0) + novaQuantidade;
            
            if (meta.quantidadeAtual >= meta.quantidadeAlvo) {
                meta.completada = true;
                meta.status = 'completa';
                mostrarNotificacao('Parabéns! Meta concluída! 🎉', 'success');
            }
            
            salvarMetas();
            renderizarMetas();
            atualizarEstatisticasMetas();
        }
    } else if (meta.tipo === 'frequencia') {
        const hoje = new Date().toISOString().split('T')[0];
        const ultimaConclusao = meta.ultimaConclusao ? 
            new Date(meta.ultimaConclusao).toISOString().split('T')[0] : null;
        
        if (ultimaConclusao === hoje) {
            mostrarNotificacao('Você já atualizou esta meta hoje!', 'info');
            return;
        }
        
        const ontem = new Date();
        ontem.setDate(ontem.getDate() - 1);
        const ontemFormatado = ontem.toISOString().split('T')[0];
        
        if (ultimaConclusao === ontemFormatado || !ultimaConclusao) {
            meta.diasConsecutivos = (meta.diasConsecutivos || 0) + 1;
        } else {
            meta.diasConsecutivos = 1;
        }
        
        meta.ultimaConclusao = new Date().toISOString();
        salvarMetas();
        renderizarMetas();
        atualizarEstatisticasMetas();
        
        mostrarNotificacao(`Progresso registrado! Dias consecutivos: ${meta.diasConsecutivos}`, 'success');
    }
}

function excluirMeta(metaId) {
    if (confirm('Tem certeza que deseja excluir esta meta?')) {
        metas = metas.filter(m => m.id !== metaId);
        salvarMetas();
        renderizarMetas();
        atualizarEstatisticasMetas();
        mostrarNotificacao('Meta excluída com sucesso!', 'success');
    }
}

function atualizarEstatisticasMetas() {
    const totalMetas = metas.length;
    const metasCompletas = metas.filter(m => m.completada).length;
    const taxaSucesso = totalMetas > 0 ? Math.round((metasCompletas / totalMetas) * 100) : 0;
    
    let diasConsecutivos = 0;
    const hoje = new Date();
    let diaAtual = new Date(hoje);
    
    for (let i = 0; i < 365; i++) {
        const diaFormatado = diaAtual.toISOString().split('T')[0];
        const obrigacoesDia = obrigacoes.filter(o => 
            o.dataCriacao === diaFormatado && o.status === 'concluido'
        ).length;
        
        if (obrigacoesDia > 0) {
            diasConsecutivos++;
            diaAtual.setDate(diaAtual.getDate() - 1);
        } else {
            break;
        }
    }
    
    if (document.getElementById('totalMetas')) {
        document.getElementById('totalMetas').textContent = totalMetas;
        document.getElementById('metasCompletas').textContent = metasCompletas;
        document.getElementById('taxaSucesso').textContent = taxaSucesso + '%';
        document.getElementById('diasConsecutivos').textContent = diasConsecutivos;
    }
}

function formatarDataSimples(data) {
    return data.toLocaleDateString('pt-BR');
}

function verificarMetasAutomaticamente() {
    const hoje = new Date().toISOString().split('T')[0];
    
    metas.forEach(meta => {
        if (meta.completada || meta.status === 'expirada') return;
        
        if (new Date(meta.dataLimite) < new Date()) {
            meta.status = 'expirada';
            mostrarNotificacao(`A meta "${meta.titulo}" expirou!`, 'warning');
        }
        
        if (meta.tipo === 'quantidade' && meta.categoria) {
            const obrigacoesConcluidas = obrigacoes.filter(o => 
                o.status === 'concluido' && 
                o.dataCriacao === hoje && 
                o.categoria === meta.categoria
            ).length;
            
            if (obrigacoesConcluidas > 0) {
                meta.quantidadeAtual = (meta.quantidadeAtual || 0) + obrigacoesConcluidas;
                
                if (meta.quantidadeAtual >= meta.quantidadeAlvo) {
                    meta.completada = true;
                    meta.status = 'completa';
                    mostrarNotificacao(`Meta "${meta.titulo}" concluída automaticamente! 🎉`, 'success');
                }
            }
        }
    });
    
    salvarMetas();
    renderizarMetas();
    atualizarEstatisticasMetas();
}


function exportarDados(formato) {
    const dadosCompletos = {
        obrigacoes: obrigacoes,
        templates: templates,
        metas: metas,
        metadata: {
            exportadoEm: new Date().toISOString(),
            versao: '1.0',
            totalObrigacoes: obrigacoes.length,
            totalTemplates: templates.length,
            totalMetas: metas.length
        }
    };
    
    let conteudo, nomeArquivo, tipoMime;
    
    if (formato === 'json') {
        conteudo = JSON.stringify(dadosCompletos, null, 2);
        nomeArquivo = `backup-obrigacoes-${new Date().toISOString().split('T')[0]}.json`;
        tipoMime = 'application/json';
    } else if (formato === 'csv') {
        conteudo = converterParaCSV(dadosCompletos);
        nomeArquivo = `backup-obrigacoes-${new Date().toISOString().split('T')[0]}.csv`;
        tipoMime = 'text/csv';
    }
    
    const blob = new Blob([conteudo], { type: tipoMime });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = nomeArquivo;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    salvarUltimoBackup();
    atualizarInfoBackup();
    
    mostrarNotificacao(`Dados exportados com sucesso em formato ${formato.toUpperCase()}!`, 'success');
}

function converterParaCSV(dados) {
    let csv = 'Tipo,Título,Descrição,Categoria,Prioridade,Status,Data Criação,Data Vencimento\n';
    
    dados.obrigacoes.forEach(obrigacao => {
        csv += `Obrigação,"${obrigacao.titulo}","${obrigacao.descricao}",${obrigacao.categoria},${obrigacao.prioridade},${obrigacao.status},${obrigacao.dataCriacao},${obrigacao.dataVencimento || ''}\n`;
    });
    
    dados.templates.forEach(template => {
        csv += `Template,"${template.nome}","${template.descricao}",${template.categoria},${template.prioridade},${template.recorrencia},${template.dataCriacao},\n`;
    });
    
    return csv;
}

function importarDados() {
    document.getElementById('importFile').click();
}

function handleImportFile(e) {
    const file = e.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const conteudo = e.target.result;
            let dados;
            
            if (file.name.endsWith('.json')) {
                dados = JSON.parse(conteudo);
            } else if (file.name.endsWith('.csv')) {
                dados = converterCSVparaJSON(conteudo);
            } else {
                throw new Error('Formato de arquivo não suportado');
            }
            
            if (!dados.obrigacoes && !dados.templates) {
                throw new Error('Arquivo não contém dados válidos');
            }
            
            if (confirm(`Deseja importar ${dados.obrigacoes?.length || 0} obrigações e ${dados.templates?.length || 0} templates? Os dados atuais serão mantidos.`)) {
                importarDadosValidados(dados);
            }
            
        } catch (error) {
            mostrarNotificacao(`Erro ao importar arquivo: ${error.message}`, 'error');
        }
    };
    reader.readAsText(file);
    
    e.target.value = '';
}

function converterCSVparaJSON(csv) {
    const linhas = csv.split('\n').filter(line => line.trim() !== '');
    const dados = { obrigacoes: [], templates: [] };
    
    for (let i = 1; i < linhas.length; i++) {
        const valores = parseCSVLinha(linhas[i]);
        
        if (valores[0] === 'Obrigação') {
            dados.obrigacoes.push({
                id: Date.now() + i,
                titulo: valores[1],
                descricao: valores[2],
                categoria: valores[3],
                prioridade: valores[4],
                status: valores[5],
                dataCriacao: valores[6],
                dataVencimento: valores[7] || null
            });
        } else if (valores[0] === 'Template') {
            dados.templates.push({
                id: Date.now() + i,
                nome: valores[1],
                descricao: valores[2],
                categoria: valores[3],
                prioridade: valores[4],
                recorrencia: valores[5],
                dataCriacao: valores[6]
            });
        }
    }
    
    return dados;
}

function parseCSVLinha(linha) {
    const valores = [];
    let valorAtual = '';
    let dentroDeAspas = false;
    
    for (let i = 0; i < linha.length; i++) {
        const char = linha[i];
        
        if (char === '"') {
            dentroDeAspas = !dentroDeAspas;
        } else if (char === ',' && !dentroDeAspas) {
            valores.push(valorAtual);
            valorAtual = '';
        } else {
            valorAtual += char;
        }
    }
    
    valores.push(valorAtual);
    return valores;
}

function importarDadosValidados(dados) {
    if (dados.obrigacoes) {
        dados.obrigacoes.forEach(novaObrigacao => {
            const existe = obrigacoes.find(o => o.id === novaObrigacao.id);
            if (!existe) {
                obrigacoes.push({
                    ...novaObrigacao,
                    id: novaObrigacao.id || Date.now() + Math.random()
                });
            }
        });
    }
    
    if (dados.templates) {
        dados.templates.forEach(novoTemplate => {
            const existe = templates.find(t => t.id === novoTemplate.id);
            if (!existe) {
                templates.push({
                    ...novoTemplate,
                    id: novoTemplate.id || Date.now() + Math.random()
                });
            }
        });
    }
    
    if (dados.metas) {
        dados.metas.forEach(novaMeta => {
            const existe = metas.find(m => m.id === novaMeta.id);
            if (!existe) {
                metas.push({
                    ...novaMeta,
                    id: novaMeta.id || Date.now() + Math.random()
                });
            }
        });
    }
    
    salvarObrigacoes();
    salvarTemplates();
    salvarMetas();
    renderizarObrigacoes();
    renderizarTemplates();
    renderizarMetas();
    atualizarDashboard();
    atualizarEstatisticas();
    atualizarEstatisticasMetas();
    atualizarInfoBackup();
    
    mostrarNotificacao('Dados importados com sucesso!', 'success');
}

function criarBackupAutomatico() {
    const chaveBackup = 'obrigacoes_backup_' + new Date().toISOString().split('T')[0];
    
    const dadosBackup = {
        obrigacoes: obrigacoes,
        templates: templates,
        metas: metas,
        backupEm: new Date().toISOString()
    };
    
    localStorage.setItem(chaveBackup, JSON.stringify(dadosBackup));
    
    const backups = JSON.parse(localStorage.getItem('backups_lista')) || [];
    backups.push({
        chave: chaveBackup,
        data: new Date().toISOString(),
        totalObrigacoes: obrigacoes.length,
        totalTemplates: templates.length,
        totalMetas: metas.length
    });
    localStorage.setItem('backups_lista', JSON.stringify(backups));
    
    salvarUltimoBackup();
    atualizarInfoBackup();
    
    mostrarNotificacao('Backup automático criado com sucesso!', 'success');
}

function salvarUltimoBackup() {
    localStorage.setItem('ultimo_backup', new Date().toISOString());
}

function atualizarInfoBackup() {
    const ultimoBackup = localStorage.getItem('ultimo_backup');
    if (document.getElementById('ultimoBackup')) {
        document.getElementById('ultimoBackup').textContent = ultimoBackup ? 
            new Date(ultimoBackup).toLocaleDateString('pt-BR') : 'Nunca';
        
        document.getElementById('totalBackupObrigacoes').textContent = obrigacoes.length;
        document.getElementById('totalBackupTemplates').textContent = templates.length;
        
        const dados = JSON.stringify({ obrigacoes, templates, metas });
        const tamanhoKB = (new Blob([dados]).size / 1024).toFixed(2);
        document.getElementById('espacoUtilizado').textContent = `${tamanhoKB} KB`;
    }
}

function limparDados() {
    if (confirm('ATENÇÃO: Esta ação irá apagar TODOS os seus dados permanentemente. Tem certeza?')) {
        if (confirm('É MESMO CERTEZA? Esta ação não pode ser desfeita!')) {
            exportarDados('json');
            
            obrigacoes = [];
            templates = [];
            metas = [];
            localStorage.removeItem('obrigacoes');
            localStorage.removeItem('templates');
            localStorage.removeItem('metas');
            localStorage.removeItem('ultimo_backup');
            
            renderizarObrigacoes();
            renderizarTemplates();
            renderizarMetas();
            atualizarDashboard();
            atualizarEstatisticas();
            atualizarEstatisticasMetas();
            atualizarInfoBackup();
            
            mostrarNotificacao('Todos os dados foram limpos! Um backup final foi exportado.', 'info');
        }
    }
}


function entrarModoFoco(obrigacaoId = null) {
    if (obrigacaoId) {
        obrigacaoFoco = obrigacoes.find(o => o.id === obrigacaoId);
    } else {
        obrigacaoFoco = obrigacoes.find(o => 
            o.prioridade === 'urgente' && o.status === 'pendente'
        ) || obrigacoes.find(o => o.status === 'pendente');
    }
    
    if (!obrigacaoFoco) {
        mostrarNotificacao('Nenhuma obrigação pendente encontrada!', 'warning');
        return;
    }
    
    document.getElementById('modoFoco').style.display = 'flex';
    document.body.style.overflow = 'hidden';
    
    document.getElementById('focoTitulo').textContent = obrigacaoFoco.titulo;
    document.getElementById('focoDescricao').textContent = obrigacaoFoco.descricao || 'Sem descrição';
    document.getElementById('focoCategoria').textContent = obrigacaoFoco.categoria;
    document.getElementById('focoPrioridade').textContent = obrigacaoFoco.prioridade;
    document.getElementById('focoStatus').textContent = obrigacaoFoco.status;
    
    iniciarContadorProdutividade();
}

function sairModoFoco() {
    document.getElementById('modoFoco').style.display = 'none';
    document.body.style.overflow = 'auto';
    pararTimerFoco();
    pararContadorProdutividade();
    obrigacaoFoco = null;
}

function iniciarTimerFoco() {
    const timerElement = document.getElementById('focoTimer');
    const btnIniciar = document.getElementById('btnIniciarTimer');
    const btnConcluir = document.getElementById('btnConcluirFoco');
    
    btnIniciar.style.display = 'none';
    btnConcluir.style.display = 'inline-block';
    
    tempoRestante = 25 * 60;
    
    timerFoco = setInterval(() => {
        tempoRestante--;
        
        const minutos = Math.floor(tempoRestante / 60);
        const segundos = tempoRestante % 60;
        timerElement.textContent = `${minutos.toString().padStart(2, '0')}:${segundos.toString().padStart(2, '0')}`;
        
        if (tempoRestante <= 0) {
            clearInterval(timerFoco);
            mostrarNotificacao('Tempo de foco concluído! Parabéns!', 'success');
            timerElement.textContent = '00:00';
            timerElement.style.color = '#2ecc71';
        }
    }, 1000);
}

function pararTimerFoco() {
    if (timerFoco) {
        clearInterval(timerFoco);
        timerFoco = null;
    }
    document.getElementById('focoTimer').textContent = '25:00';
    document.getElementById('focoTimer').style.color = '#4361ee';
}

function concluirObrigacaoFoco() {
    if (obrigacaoFoco) {
        obrigacaoFoco.status = 'concluido';
        salvarObrigacoes();
        renderizarObrigacoes();
        atualizarDashboard();
        atualizarEstatisticas();
        
        mostrarNotificacao('Obrigação concluída com sucesso!', 'success');
    }
    
    sairModoFoco();
}

function iniciarContadorProdutividade() {
    tempoProdutivo = 0;
    const contador = document.getElementById('contadorProdutividade');
    if (contador) contador.style.display = 'block';
    
    timerProdutividade = setInterval(() => {
        tempoProdutivo++;
        const horas = Math.floor(tempoProdutivo / 3600);
        const minutos = Math.floor((tempoProdutivo % 3600) / 60);
        const segundos = tempoProdutivo % 60;
        
        const tempoElement = document.getElementById('tempoProdutivo');
        if (tempoElement) {
            tempoElement.textContent = 
                `${horas.toString().padStart(2, '0')}:${minutos.toString().padStart(2, '0')}:${segundos.toString().padStart(2, '0')}`;
        }
    }, 1000);
}

function pararContadorProdutividade() {
    if (timerProdutividade) {
        clearInterval(timerProdutividade);
        timerProdutividade = null;
    }
    const contador = document.getElementById('contadorProdutividade');
    if (contador) contador.style.display = 'none';
    
    salvarTempoProdutivo(tempoProdutivo);
}

function salvarTempoProdutivo(tempo) {
    const hoje = new Date().toISOString().split('T')[0];
    const historico = JSON.parse(localStorage.getItem('historicoProdutividade')) || {};
    
    historico[hoje] = (historico[hoje] || 0) + tempo;
    localStorage.setItem('historicoProdutividade', JSON.stringify(historico));
}


function mostrarNotificacao(mensagem, tipo = 'info') {
    const container = document.getElementById('notificationContainer');
    if (!container) return;
    
    const notification = document.createElement('div');
    notification.className = `notification ${tipo}`;
    notification.innerHTML = `
        <i class="fas fa-${tipo === 'success' ? 'check-circle' : tipo === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
        <span>${mensagem}</span>
        <button class="notification-close" onclick="this.parentElement.remove()">&times;</button>
    `;
    
    container.appendChild(notification);
    
    setTimeout(() => {
        if (notification.parentElement) {
            notification.remove();
        }
    }, 5000);
}

function verificarStatusObrigacoes() {
    console.log('=== STATUS DAS OBRIGAÇÕES ===');
    obrigacoes.forEach(obrigacao => {
        console.log(`Título: ${obrigacao.titulo}, Status: ${obrigacao.status}`);
    });
    
    const statusCount = {};
    obrigacoes.forEach(obrigacao => {
        statusCount[obrigacao.status] = (statusCount[obrigacao.status] || 0) + 1;
    });
    console.log('Contagem por status:', statusCount);
}

function toggleModoEscuro() {
    document.body.classList.toggle('dark-mode');
    const isDarkMode = document.body.classList.contains('dark-mode');
    localStorage.setItem('darkMode', isDarkMode);
    mostrarNotificacao(`Modo ${isDarkMode ? 'escuro' : 'claro'} ativado!`, 'info');

    inicializarGraficos();
}

function mostrarAjuda() {
    mostrarNotificacao('Sistema de Obrigações Diárias - Use os filtros e templates para organizar suas tarefas!', 'info');
}

function filtrarPorPrioridade(prioridade) {
    document.getElementById('filter-prioridade').value = prioridade;
    aplicarFiltros();
}

function filtrarPorStatus(status) {
    document.getElementById('filter-status').value = status;
    aplicarFiltros();
}

function limparFiltros() {
    document.getElementById('search-input').value = '';
    document.getElementById('filter-categoria').value = '';
    document.getElementById('filter-prioridade').value = '';
    document.getElementById('filter-status').value = '';
    aplicarFiltros();
}


        function inicializarSistema() {
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
            }
            
            renderizarObrigacoes();
            renderizarTemplates();
            renderizarMetas();
            
            atualizarDashboard();
            inicializarGraficos();
            atualizarEstatisticas();
            atualizarEstatisticasMetas();
            atualizarInfoBackup()
    
            const searchInput = document.getElementById('search-input');
            const filterCategoria = document.getElementById('filter-categoria');
            const filterPrioridade = document.getElementById('filter-prioridade');
            const filterStatus = document.getElementById('filter-status');
            
            if (searchInput) searchInput.addEventListener('input', aplicarFiltros);
            if (filterCategoria) filterCategoria.addEventListener('change', aplicarFiltros);
            if (filterPrioridade) filterPrioridade.addEventListener('change', aplicarFiltros);
            if (filterStatus) filterStatus.addEventListener('change', aplicarFiltros);
    
            const btnCancelar = document.getElementById('btnCancelar');
            if (btnCancelar) btnCancelar.addEventListener('click', cancelarEdicao);
    
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    const modoFoco = document.getElementById('modoFoco');
                    const obrigacaoModal = document.getElementById('obrigacaoModal');
                    
                    if (modoFoco && modoFoco.style.display === 'flex') {
                        sairModoFoco();
                    }
                    if (obrigacaoModal && obrigacaoModal.style.display === 'flex') {
                        fecharModal();
                    }
                }
            });
    
            setInterval(verificarMetasAutomaticamente, 60 * 60 * 1000);
            
            mostrarNotificacao('Sistema carregado com sucesso!', 'success');
        }

document.addEventListener('DOMContentLoaded', function() {
    setTimeout(inicializarSistema, 100);
});

    </script>
</body>
</html>
